<!DOCTYPE html>
<html lang="en" data-accent-color="lime" data-content_root="../../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>icspacket.proto.mms.connection - icspacket 0.1.dev1+g8bd5d6c80 documentation</title><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />
      <link rel="canonical" href="https://matrixeditor.github.io/icspacket/_modules/icspacket/proto/mms/connection.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/shibuya.css?v=d48c410d" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
<meta property="og:url" content="https://matrixeditor.github.io/icspacket/_modules/icspacket/proto/mms/connection.html"/>
<meta property="og:title" content="icspacket.proto.mms.connection"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../../index.html">
      
      
      <strong>icspacket</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul>
      <li class="link"><a class="js-menu" href="../../../../getting-started/protocols.html" id="nav-trigger-1" aria-controls="nav-children-1">
            <span>Examples</span>
            <i class="i-lucide chevron-down"></i>
          </a>
        <ul id="nav-children-1" aria-labelledby="nav-trigger-1"><li><a href="../../../../protocols/mms/examples.html">
                <span>MMS Utilities</span>
                <small>Manufacturing Message Specification tools</small>
              </a></li><li><a href="../../../../protocols/dnp3/examples.html">
                <span>DNP3 Tools</span>
                <small>DNP3 utilities and tools</small>
              </a></li></ul>
      </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/MatrixEditor/icspacket" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/MatrixEditor/icspacket/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="2"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/protocols.html">Protocols Overview</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/coreapi.html">Core API Reference</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">DNP3 / IEEE 1815</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/dnp3read.html">Reading Objects</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/dnp3dump.html">Dumping Objects</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/link.html">Link Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/transport.html">Transport Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/application.html">Application Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/master.html">Master</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/object_library.html">Object Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/primitives.html">Primitive Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/coding.html">Encoding / Decoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/variations.html">Variations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/coding_utils.html">Object Utilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">MMS / ISO 9506</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_vars.html">Variable Target Format</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_vars.html#variableaccess-service-rwq">VariableAccess Service (rwq)</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_files.html">FileManagement Service</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_conn.html">MMS Connection</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_data.html">Data Conversion</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">ACSE / X.227</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/acse/api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COPP / X.226 / ISO 8823</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/copp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/copp/presentation.html">ISO Presentation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/copp/utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COSP / X.225 / ISO 8237-1</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/cosp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/tsdu.html">TSDU</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/spdu.html">SPDU Types</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/values.html">Parameter Values (PV)</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/session.html">ISO Session</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COTP / X.224</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/cotp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cotp/structs.html">TPDU Types</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cotp/connection.html">Connection</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">TPKT Protocol (RFC1006)</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/tpkt/usage.html">Using a TPKT Wrapper</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/tpkt/api.html">API Reference</a></li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/MatrixEditor/icspacket"
  data-type="github" data-user="MatrixEditor" data-repo="icspacket">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span style="font-size: small;">MatrixEditor/icspacket</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../../index.html"><span itemprop="name">icspacket</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">icspacket.proto.mms.connection</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for icspacket.proto.mms.connection</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="c1"># This file is part of icspacket.</span>
</span><span data-line="2"><span class="c1"># Copyright (C) 2025-present  MatrixEditor @ github</span>
</span><span data-line="3"><span class="c1">#</span>
</span><span data-line="4"><span class="c1"># This program is free software: you can redistribute it and/or modify</span>
</span><span data-line="5"><span class="c1"># it under the terms of the GNU General Public License as published by</span>
</span><span data-line="6"><span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
</span><span data-line="7"><span class="c1"># (at your option) any later version.</span>
</span><span data-line="8"><span class="c1">#</span>
</span><span data-line="9"><span class="c1"># This program is distributed in the hope that it will be useful,</span>
</span><span data-line="10"><span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span data-line="11"><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span data-line="12"><span class="c1"># GNU General Public License for more details.</span>
</span><span data-line="13"><span class="c1">#</span>
</span><span data-line="14"><span class="c1"># You should have received a copy of the GNU General Public License</span>
</span><span data-line="15"><span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</span><span data-line="16"><span class="kn">import</span><span class="w"> </span><span class="nn">logging</span>
</span><span data-line="17">
</span><span data-line="18"><span class="kn">from</span><span class="w"> </span><span class="nn">typing_extensions</span><span class="w"> </span><span class="kn">import</span> <span class="n">override</span>
</span><span data-line="19">
</span><span data-line="20"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.core.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">connection</span>
</span><span data-line="21"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.tpkt</span><span class="w"> </span><span class="kn">import</span> <span class="n">tpktsock</span>
</span><span data-line="22"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.cotp.connection</span><span class="w"> </span><span class="kn">import</span> <span class="n">COTP_Connection</span>
</span><span data-line="23"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.iso_ses.session</span><span class="w"> </span><span class="kn">import</span> <span class="n">ISO_Session</span><span class="p">,</span> <span class="n">ISO_SessionSettings</span>
</span><span data-line="24"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.iso_pres.presentation</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="25">    <span class="n">ISO_Presentation</span><span class="p">,</span>
</span><span data-line="26">    <span class="n">ISO_PresentationSettings</span><span class="p">,</span>
</span><span data-line="27"><span class="p">)</span>
</span><span data-line="28"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms</span><span class="w"> </span><span class="kn">import</span> <span class="n">MMS_ABSTRACT_SYNTAX_NAME</span><span class="p">,</span> <span class="n">MMS_PRESENTATION_CONTEXT_ID</span>
</span><span data-line="29"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms.asn1types</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="30">    <span class="n">ABRT_source</span><span class="p">,</span>
</span><span data-line="31">    <span class="n">AccessResult</span><span class="p">,</span>
</span><span data-line="32">    <span class="n">AdditionalService_Request</span><span class="p">,</span>
</span><span data-line="33">    <span class="n">AdditionalService_Response</span><span class="p">,</span>
</span><span data-line="34">    <span class="n">Address</span><span class="p">,</span>
</span><span data-line="35">    <span class="n">Conclude_RequestPDU</span><span class="p">,</span>
</span><span data-line="36">    <span class="n">Confirmed_ErrorPDU</span><span class="p">,</span>
</span><span data-line="37">    <span class="n">Confirmed_RequestPDU</span><span class="p">,</span>
</span><span data-line="38">    <span class="n">ConfirmedServiceRequest</span><span class="p">,</span>
</span><span data-line="39">    <span class="n">ConfirmedServiceResponse</span><span class="p">,</span>
</span><span data-line="40">    <span class="n">Data</span><span class="p">,</span>
</span><span data-line="41">    <span class="n">DataAccessError</span><span class="p">,</span>
</span><span data-line="42">    <span class="n">DirectoryEntry</span><span class="p">,</span>
</span><span data-line="43">    <span class="n">DomainName</span><span class="p">,</span>
</span><span data-line="44">    <span class="n">FileClose_Request</span><span class="p">,</span>
</span><span data-line="45">    <span class="n">FileDelete_Request</span><span class="p">,</span>
</span><span data-line="46">    <span class="n">FileDirectory_Request</span><span class="p">,</span>
</span><span data-line="47">    <span class="n">FileName</span><span class="p">,</span>
</span><span data-line="48">    <span class="n">FileOpen_Request</span><span class="p">,</span>
</span><span data-line="49">    <span class="n">FileRead_Request</span><span class="p">,</span>
</span><span data-line="50">    <span class="n">FileRename_Request</span><span class="p">,</span>
</span><span data-line="51">    <span class="n">GetCapabilityList_Request</span><span class="p">,</span>
</span><span data-line="52">    <span class="n">GetDomainAttributes_Request</span><span class="p">,</span>
</span><span data-line="53">    <span class="n">GetDomainAttributes_Response</span><span class="p">,</span>
</span><span data-line="54">    <span class="n">GetNameList_Request</span><span class="p">,</span>
</span><span data-line="55">    <span class="n">GetVariableAccessAttributes_Request</span><span class="p">,</span>
</span><span data-line="56">    <span class="n">GetVariableAccessAttributes_Response</span><span class="p">,</span>
</span><span data-line="57">    <span class="n">Identifier</span><span class="p">,</span>
</span><span data-line="58">    <span class="n">Identify_Request</span><span class="p">,</span>
</span><span data-line="59">    <span class="n">Initiate_RequestPDU</span><span class="p">,</span>
</span><span data-line="60">    <span class="n">MMSpdu</span><span class="p">,</span>
</span><span data-line="61">    <span class="n">ObjectClass</span><span class="p">,</span>
</span><span data-line="62">    <span class="n">ObjectName</span><span class="p">,</span>
</span><span data-line="63">    <span class="n">Read_Request</span><span class="p">,</span>
</span><span data-line="64">    <span class="n">RejectPDU</span><span class="p">,</span>
</span><span data-line="65">    <span class="n">Release_request_reason</span><span class="p">,</span>
</span><span data-line="66">    <span class="n">ServiceError</span><span class="p">,</span>
</span><span data-line="67">    <span class="n">Status_Request</span><span class="p">,</span>
</span><span data-line="68">    <span class="n">StatusResponse</span><span class="p">,</span>
</span><span data-line="69">    <span class="n">VariableAccessSpecification</span><span class="p">,</span>
</span><span data-line="70">    <span class="n">VMDReset_Request</span><span class="p">,</span>
</span><span data-line="71">    <span class="n">VMDStop_Request</span><span class="p">,</span>
</span><span data-line="72">    <span class="n">Write_Request</span><span class="p">,</span>
</span><span data-line="73"><span class="p">)</span>
</span><span data-line="74"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms.data</span><span class="w"> </span><span class="kn">import</span> <span class="n">FileHandle</span>
</span><span data-line="75"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms.util</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="76">    <span class="n">ObjectScope</span><span class="p">,</span>
</span><span data-line="77">    <span class="n">VariableAccessItem</span><span class="p">,</span>
</span><span data-line="78">    <span class="n">new_initiate_request</span><span class="p">,</span>
</span><span data-line="79"><span class="p">)</span>
</span><span data-line="80"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms.acse</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="81">    <span class="n">Association</span><span class="p">,</span>
</span><span data-line="82">    <span class="n">Authenticator</span><span class="p">,</span>
</span><span data-line="83"><span class="p">)</span>
</span><span data-line="84"><span class="kn">from</span><span class="w"> </span><span class="nn">icspacket.proto.mms.exceptions</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="85">    <span class="n">MMSConnectionError</span><span class="p">,</span>
</span><span data-line="86">    <span class="n">MMSServiceError</span><span class="p">,</span>
</span><span data-line="87">    <span class="n">MMSUnknownServiceError</span><span class="p">,</span>
</span><span data-line="88"><span class="p">)</span>
</span><span data-line="89">
</span><span data-line="90"><span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
</span><span data-line="91">
</span><span data-line="92">
<div class="viewcode-block" id="MMS_Connection">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection">[docs]</a>
</span><span data-line="93"><span class="k">class</span><span class="w"> </span><span class="nc">MMS_Connection</span><span class="p">(</span><span class="n">connection</span><span class="p">):</span>
</span><span data-line="94"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="95"><span class="sd">    Implementation of the MMS (Manufacturing Message Specification) connection</span>
</span><span data-line="96"><span class="sd">    handling (ISO 9506-1,2).</span>
</span><span data-line="97">
</span><span data-line="98"><span class="sd">    This class provides a high-level MMS service endpoint on top of the ISO OSI stack.</span>
</span><span data-line="99"><span class="sd">    It integrates the following layers into a single connection object:</span>
</span><span data-line="100">
</span><span data-line="101"><span class="sd">    .. code-block:: text</span>
</span><span data-line="102">
</span><span data-line="103"><span class="sd">        +-----------------------------+</span>
</span><span data-line="104"><span class="sd">        | MMS (ISO 9506)              |</span>
</span><span data-line="105"><span class="sd">        +-----------------------------+</span>
</span><span data-line="106"><span class="sd">        | ACSE Association            |</span>
</span><span data-line="107"><span class="sd">        +-----------------------------+</span>
</span><span data-line="108"><span class="sd">        | ISO Presentation (ISO 8823) |</span>
</span><span data-line="109"><span class="sd">        +-----------------------------+</span>
</span><span data-line="110"><span class="sd">        | ISO Session (ISO 8327)      |</span>
</span><span data-line="111"><span class="sd">        +-----------------------------+</span>
</span><span data-line="112"><span class="sd">        | Transport (COTP, RFC 905)   |</span>
</span><span data-line="113"><span class="sd">        +-----------------------------+</span>
</span><span data-line="114"><span class="sd">        | TPKT / TCP                  |</span>
</span><span data-line="115"><span class="sd">        +-----------------------------+</span>
</span><span data-line="116">
</span><span data-line="117"><span class="sd">    The class encapsulates these layers so that MMS service primitives such as</span>
</span><span data-line="118"><span class="sd">    :meth:`associate`, :meth:`release`, :meth:`abort`, and :meth:`close` can be</span>
</span><span data-line="119"><span class="sd">    directly invoked by the user without manually handling lower-layer PDUs.</span>
</span><span data-line="120">
</span><span data-line="121"><span class="sd">    Establishing an MMS association to a remote server:</span>
</span><span data-line="122">
</span><span data-line="123"><span class="sd">    .. code-block:: python</span>
</span><span data-line="124">
</span><span data-line="125"><span class="sd">        from mms.connection import MMS_Connection</span>
</span><span data-line="126">
</span><span data-line="127"><span class="sd">        # Create MMS connection</span>
</span><span data-line="128"><span class="sd">        mms_conn = MMS_Connection()</span>
</span><span data-line="129">
</span><span data-line="130"><span class="sd">        # Connect and associate with a peer MMS user</span>
</span><span data-line="131"><span class="sd">        mms_conn.associate((&quot;192.168.1.100&quot;, 102))</span>
</span><span data-line="132"><span class="sd">        assert mms_conn.is_valid():</span>
</span><span data-line="133">
</span><span data-line="134"><span class="sd">        # Release the association in an orderly manner</span>
</span><span data-line="135"><span class="sd">        mms_conn.release()</span>
</span><span data-line="136">
</span><span data-line="137"><span class="sd">    :param cotp_conn: Optional transport layer (COTP) connection to use. If not provided,</span>
</span><span data-line="138"><span class="sd">        a new :class:`COTP_Connection` is created using the default TPKT socket.</span>
</span><span data-line="139"><span class="sd">    :type cotp_conn: COTP_Connection | None</span>
</span><span data-line="140"><span class="sd">    :param session_config: Optional ISO Session settings, passed down to the session layer.</span>
</span><span data-line="141"><span class="sd">    :type session_config: ISO_SessionSettings | None</span>
</span><span data-line="142"><span class="sd">    :param presentation_config: Optional ISO Presentation settings, passed to the</span>
</span><span data-line="143"><span class="sd">        presentation layer.</span>
</span><span data-line="144"><span class="sd">    :type presentation_config: ISO_PresentationSettings | None</span>
</span><span data-line="145"><span class="sd">    :param auth: Optional ACSE :class:`Authenticator` instance for authentication handling.</span>
</span><span data-line="146"><span class="sd">    :type auth: Authenticator | None</span>
</span><span data-line="147"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="148">
</span><span data-line="149">    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span>
</span><span data-line="150">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="151">        <span class="n">cotp_conn</span><span class="p">:</span> <span class="n">COTP_Connection</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="152">        <span class="n">session_config</span><span class="p">:</span> <span class="n">ISO_SessionSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="153">        <span class="n">presentation_config</span><span class="p">:</span> <span class="n">ISO_PresentationSettings</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="154">        <span class="n">auth</span><span class="p">:</span> <span class="n">Authenticator</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="155">    <span class="p">):</span>
</span><span data-line="156">        <span class="c1"># First, initialize the connection class and invalidate this connection</span>
</span><span data-line="157">        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
</span><span data-line="158">
</span><span data-line="159">        <span class="c1"># If the transport layer connection is not provided, create one</span>
</span><span data-line="160">        <span class="k">if</span> <span class="n">cotp_conn</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="161">            <span class="n">cotp_conn</span> <span class="o">=</span> <span class="n">COTP_Connection</span><span class="p">(</span><span class="n">sock_cls</span><span class="o">=</span><span class="n">tpktsock</span><span class="p">)</span>
</span><span data-line="162">
</span><span data-line="163">        <span class="c1"># We only store the presentation layer here. Transport layer can be accessed via</span>
</span><span data-line="164">        <span class="c1"># the session</span>
</span><span data-line="165">        <span class="bp">self</span><span class="o">.</span><span class="n">__presentation</span> <span class="o">=</span> <span class="n">ISO_Presentation</span><span class="p">(</span>
</span><span data-line="166">            <span class="n">ISO_Session</span><span class="p">(</span><span class="n">cotp_conn</span><span class="p">,</span> <span class="n">session_config</span><span class="p">),</span>
</span><span data-line="167">            <span class="n">presentation_config</span><span class="p">,</span>
</span><span data-line="168">        <span class="p">)</span>
</span><span data-line="169">        <span class="bp">self</span><span class="o">.</span><span class="n">__assoc</span> <span class="o">=</span> <span class="n">Association</span><span class="p">(</span>
</span><span data-line="170">            <span class="n">presentation</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="p">,</span>
</span><span data-line="171">            <span class="n">pres_ctx_id</span><span class="o">=</span><span class="n">MMS_PRESENTATION_CONTEXT_ID</span><span class="p">,</span>
</span><span data-line="172">            <span class="n">syntax_name</span><span class="o">=</span><span class="n">MMS_ABSTRACT_SYNTAX_NAME</span><span class="p">,</span>
</span><span data-line="173">            <span class="n">asn1_cls</span><span class="o">=</span><span class="n">MMSpdu</span><span class="p">,</span>
</span><span data-line="174">            <span class="n">authenticator</span><span class="o">=</span><span class="n">auth</span><span class="p">,</span>
</span><span data-line="175">        <span class="p">)</span>
</span><span data-line="176">        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span>
</span><span data-line="177">        <span class="bp">self</span><span class="o">.</span><span class="n">__invoke_id</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="178">
</span><span data-line="179">    <span class="c1"># ---------------------------------------------------------------------- #</span>
</span><span data-line="180">    <span class="c1"># Properties</span>
</span><span data-line="181">    <span class="c1"># ---------------------------------------------------------------------- #</span>
</span><span data-line="182">    <span class="nd">@property</span>
</span><span data-line="183">    <span class="k">def</span><span class="w"> </span><span class="nf">session</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ISO_Session</span><span class="p">:</span>
</span><span data-line="184"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="185"><span class="sd">        The ISO Session layer object.</span>
</span><span data-line="186">
</span><span data-line="187"><span class="sd">        :return: Underlying ISO Session instance.</span>
</span><span data-line="188"><span class="sd">        :rtype: ISO_Session</span>
</span><span data-line="189"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="190">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">session</span>
</span><span data-line="191">
</span><span data-line="192">    <span class="nd">@property</span>
</span><span data-line="193">    <span class="k">def</span><span class="w"> </span><span class="nf">transport</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">COTP_Connection</span><span class="p">:</span>
</span><span data-line="194"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="195"><span class="sd">        The transport layer (COTP) connection.</span>
</span><span data-line="196">
</span><span data-line="197"><span class="sd">        :return: Underlying COTP transport connection.</span>
</span><span data-line="198"><span class="sd">        :rtype: COTP_Connection</span>
</span><span data-line="199"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="200">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">transport</span>
</span><span data-line="201">
</span><span data-line="202">    <span class="nd">@property</span>
</span><span data-line="203">    <span class="k">def</span><span class="w"> </span><span class="nf">presentation</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ISO_Presentation</span><span class="p">:</span>
</span><span data-line="204"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="205"><span class="sd">        The ISO Presentation layer object.</span>
</span><span data-line="206">
</span><span data-line="207"><span class="sd">        :return: The presentation layer instance for this MMS connection.</span>
</span><span data-line="208"><span class="sd">        :rtype: ISO_Presentation</span>
</span><span data-line="209"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="210">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__presentation</span>
</span><span data-line="211">
</span><span data-line="212">    <span class="nd">@property</span>
</span><span data-line="213">    <span class="k">def</span><span class="w"> </span><span class="nf">association</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Association</span><span class="p">:</span>
</span><span data-line="214"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="215"><span class="sd">        The ACSE Association handler for this MMS connection.</span>
</span><span data-line="216">
</span><span data-line="217"><span class="sd">        :return: Association object responsible for ACSE/MMS binding.</span>
</span><span data-line="218"><span class="sd">        :rtype: Association</span>
</span><span data-line="219"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="220">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__assoc</span>
</span><span data-line="221">
</span><span data-line="222">    <span class="nd">@property</span>
</span><span data-line="223">    <span class="k">def</span><span class="w"> </span><span class="nf">next_invoke_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="224"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="225"><span class="sd">        Increment and return the next available invoke-id.</span>
</span><span data-line="226">
</span><span data-line="227"><span class="sd">        This value is used to uniquely identify outstanding MMS service</span>
</span><span data-line="228"><span class="sd">        requests.</span>
</span><span data-line="229">
</span><span data-line="230"><span class="sd">        :return: Next invoke identifier.</span>
</span><span data-line="231"><span class="sd">        :rtype: int</span>
</span><span data-line="232"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="233">        <span class="bp">self</span><span class="o">.</span><span class="n">__invoke_id</span> <span class="o">+=</span> <span class="mi">1</span>
</span><span data-line="234">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__invoke_id</span>
</span><span data-line="235">
</span><span data-line="236">    <span class="nd">@property</span>
</span><span data-line="237">    <span class="k">def</span><span class="w"> </span><span class="nf">invoke_id</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="238"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="239"><span class="sd">        The current invoke-id counter.</span>
</span><span data-line="240">
</span><span data-line="241"><span class="sd">        :return: Current invoke identifier.</span>
</span><span data-line="242"><span class="sd">        :rtype: int</span>
</span><span data-line="243"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="244">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__invoke_id</span>
</span><span data-line="245">
</span><span data-line="246">    <span class="c1"># ---------------------------------------------------------------------- #</span>
</span><span data-line="247">    <span class="c1"># MMS Connection Operations</span>
</span><span data-line="248">    <span class="c1"># ---------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="MMS_Connection.connect">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.connect">[docs]</a>
</span><span data-line="249">    <span class="nd">@override</span>
</span><span data-line="250">    <span class="k">def</span><span class="w"> </span><span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="251"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="252"><span class="sd">        Establish a transport/session/presentation connection.</span>
</span><span data-line="253">
</span><span data-line="254"><span class="sd">        If the connection is already established, this call is ignored.</span>
</span><span data-line="255">
</span><span data-line="256"><span class="sd">        :param address: Remote address (host, port) to connect to.</span>
</span><span data-line="257"><span class="sd">        :type address: tuple[str, int]</span>
</span><span data-line="258"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="259">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
</span><span data-line="260">            <span class="k">return</span>  <span class="c1"># simply ignore this call to connect()</span>
</span><span data-line="261">
</span><span data-line="262">        <span class="bp">self</span><span class="o">.</span><span class="n">association</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</span><span data-line="263">        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">association</span><span class="o">.</span><span class="n">is_connected</span><span class="p">()</span></div>

</span><span data-line="264">
<div class="viewcode-block" id="MMS_Connection.associate">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.associate">[docs]</a>
</span><span data-line="265">    <span class="k">def</span><span class="w"> </span><span class="nf">associate</span><span class="p">(</span>
</span><span data-line="266">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="267">        <span class="n">address</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="268">        <span class="n">request</span><span class="p">:</span> <span class="n">Initiate_RequestPDU</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="269">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="270"><span class="w">        </span><span class="sd">&quot;&quot;&quot;6.9.1 M-ASSOCIATE Service (ISO 9506-1).</span>
</span><span data-line="271">
</span><span data-line="272"><span class="sd">        Establishes an MMS association with a peer MMS-user.</span>
</span><span data-line="273">
</span><span data-line="274"><span class="sd">        This method performs the ACSE and MMS-level handshake by sending an</span>
</span><span data-line="275"><span class="sd">        Initiate Request PDU and validating the Initiate Response PDU.</span>
</span><span data-line="276">
</span><span data-line="277"><span class="sd">        :param address: Optional peer address (host, port). If provided,</span>
</span><span data-line="278"><span class="sd">            a transport connection is established first.</span>
</span><span data-line="279"><span class="sd">        :type address: tuple[str, int] | None</span>
</span><span data-line="280"><span class="sd">        :param request: Optional Initiate Request PDU. If not provided,</span>
</span><span data-line="281"><span class="sd">            a default one is created using :func:`new_initiate_request`.</span>
</span><span data-line="282"><span class="sd">        :type request: Initiate_RequestPDU | None</span>
</span><span data-line="283"><span class="sd">        :raises MMSConnectionError: If the peer responds with an MMS error PDU.</span>
</span><span data-line="284"><span class="sd">        :raises TypeError: If the peer responds with an unexpected PDU type.</span>
</span><span data-line="285"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="286">        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_valid</span><span class="p">():</span>
</span><span data-line="287">            <span class="k">return</span>
</span><span data-line="288">
</span><span data-line="289">        <span class="k">if</span> <span class="n">address</span><span class="p">:</span>
</span><span data-line="290">            <span class="bp">self</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">address</span><span class="p">)</span>
</span><span data-line="291">
</span><span data-line="292">        <span class="c1"># M-ASSOCIATE.req</span>
</span><span data-line="293">        <span class="n">request</span> <span class="o">=</span> <span class="n">request</span> <span class="ow">or</span> <span class="n">new_initiate_request</span><span class="p">()</span>
</span><span data-line="294">        <span class="n">mms_pdu</span> <span class="o">=</span> <span class="n">MMSpdu</span><span class="p">(</span><span class="n">initiate_RequestPDU</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="295">
</span><span data-line="296">        <span class="n">raw_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">association</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="n">mms_pdu</span><span class="o">.</span><span class="n">ber_encode</span><span class="p">())</span>
</span><span data-line="297">        <span class="k">try</span><span class="p">:</span>
</span><span data-line="298">            <span class="c1"># M-ASSOCIATE.cnf</span>
</span><span data-line="299">            <span class="n">mms_pdu</span> <span class="o">=</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">ber_decode</span><span class="p">(</span><span class="n">raw_data</span><span class="p">)</span>
</span><span data-line="300">        <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
</span><span data-line="301">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid ACSE associated data: </span><span class="si">{</span><span class="n">raw_data</span><span class="o">.</span><span class="n">hex</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="302">
</span><span data-line="303">        <span class="k">if</span> <span class="n">mms_pdu</span><span class="o">.</span><span class="n">present</span> <span class="o">==</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_initiate_RequestPDU</span><span class="p">:</span>
</span><span data-line="304">            <span class="k">raise</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">mms_pdu</span><span class="o">.</span><span class="n">initiate_ErrorPDU</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span data-line="305">
</span><span data-line="306">        <span class="k">if</span> <span class="n">mms_pdu</span><span class="o">.</span><span class="n">present</span> <span class="o">!=</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_initiate_ResponsePDU</span><span class="p">:</span>
</span><span data-line="307">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid MMS response: </span><span class="si">{</span><span class="n">mms_pdu</span><span class="o">.</span><span class="n">present</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="308">
</span><span data-line="309">        <span class="bp">self</span><span class="o">.</span><span class="n">_valid</span> <span class="o">=</span> <span class="kc">True</span></div>

</span><span data-line="310">
<div class="viewcode-block" id="MMS_Connection.release">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.release">[docs]</a>
</span><span data-line="311">    <span class="k">def</span><span class="w"> </span><span class="nf">release</span><span class="p">(</span>
</span><span data-line="312">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="313">        <span class="n">reason</span><span class="p">:</span> <span class="n">Release_request_reason</span><span class="o">.</span><span class="n">VALUES</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="314">        <span class="n">graceful</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="315">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="316"><span class="w">        </span><span class="sd">&quot;&quot;&quot;6.9.2 M-RELEASE Service (ISO 9506-1).</span>
</span><span data-line="317">
</span><span data-line="318"><span class="sd">        Terminate the association in an orderly manner.</span>
</span><span data-line="319">
</span><span data-line="320"><span class="sd">        :param reason: Optional release reason.</span>
</span><span data-line="321"><span class="sd">        :type reason: Release_request_reason.VALUES | None</span>
</span><span data-line="322"><span class="sd">        :param graceful: If ``True``, attempt a graceful release.</span>
</span><span data-line="323"><span class="sd">        :type graceful: bool</span>
</span><span data-line="324"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="325">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
</span><span data-line="326">            <span class="k">return</span>
</span><span data-line="327">
</span><span data-line="328">        <span class="bp">self</span><span class="o">.</span><span class="n">association</span><span class="o">.</span><span class="n">release</span><span class="p">(</span><span class="n">reason</span><span class="p">,</span> <span class="n">graceful</span><span class="p">)</span>
</span><span data-line="329">        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="330">        <span class="bp">self</span><span class="o">.</span><span class="n">_valid</span> <span class="o">=</span> <span class="kc">False</span></div>

</span><span data-line="331">
<div class="viewcode-block" id="MMS_Connection.abort">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.abort">[docs]</a>
</span><span data-line="332">    <span class="k">def</span><span class="w"> </span><span class="nf">abort</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">source</span><span class="p">:</span> <span class="n">ABRT_source</span><span class="o">.</span><span class="n">VALUES</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="333"><span class="w">        </span><span class="sd">&quot;&quot;&quot;6.9.4 M-U-ABORT Service (ISO 9506-1).</span>
</span><span data-line="334">
</span><span data-line="335"><span class="sd">        Abruptly terminate the association without completing an orderly</span>
</span><span data-line="336"><span class="sd">        release handshake.</span>
</span><span data-line="337">
</span><span data-line="338"><span class="sd">        :param source: Optional abort source identifier.</span>
</span><span data-line="339"><span class="sd">        :type source: ABRT_source.VALUES | None</span>
</span><span data-line="340"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="341">        <span class="bp">self</span><span class="o">.</span><span class="n">association</span><span class="o">.</span><span class="n">abort</span><span class="p">(</span><span class="n">source</span><span class="p">)</span>
</span><span data-line="342">        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="343">        <span class="bp">self</span><span class="o">.</span><span class="n">_valid</span> <span class="o">=</span> <span class="kc">False</span></div>

</span><span data-line="344">
<div class="viewcode-block" id="MMS_Connection.close">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.close">[docs]</a>
</span><span data-line="345">    <span class="nd">@override</span>
</span><span data-line="346">    <span class="k">def</span><span class="w"> </span><span class="nf">close</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="347"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="348"><span class="sd">        Close the MMS association and underlying presentation connection.</span>
</span><span data-line="349">
</span><span data-line="350"><span class="sd">        This performs a Conclude handshake (``Conclude-Request`` /</span>
</span><span data-line="351"><span class="sd">        ``Conclude-Response``). If the peer responds with an error,</span>
</span><span data-line="352"><span class="sd">        :class:`MMSConnectionError` is raised.</span>
</span><span data-line="353">
</span><span data-line="354"><span class="sd">        :raises MMSConnectionError: If the peer responds with a conclude error.</span>
</span><span data-line="355"><span class="sd">        :raises TypeError: If the peer responds with an unexpected PDU.</span>
</span><span data-line="356"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="357">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_connected</span><span class="p">():</span>
</span><span data-line="358">            <span class="k">return</span>
</span><span data-line="359">
</span><span data-line="360">        <span class="n">pdu</span> <span class="o">=</span> <span class="n">Conclude_RequestPDU</span><span class="p">()</span>
</span><span data-line="361">        <span class="n">pdu</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="362">        <span class="n">mms_pdu</span> <span class="o">=</span> <span class="n">MMSpdu</span><span class="p">(</span><span class="n">conclude_RequestPDU</span><span class="o">=</span><span class="n">pdu</span><span class="p">)</span>
</span><span data-line="363">        <span class="bp">self</span><span class="o">.</span><span class="n">send_mms_data</span><span class="p">(</span><span class="n">mms_pdu</span><span class="p">)</span>
</span><span data-line="364">
</span><span data-line="365">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_mms_data</span><span class="p">()</span>
</span><span data-line="366">        <span class="k">match</span> <span class="n">response</span><span class="o">.</span><span class="n">present</span><span class="p">:</span>
</span><span data-line="367">            <span class="k">case</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_conclude_ErrorPDU</span><span class="p">:</span>
</span><span data-line="368">                <span class="k">raise</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">conclude_ErrorPDU</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
</span><span data-line="369">            <span class="k">case</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_conclude_ResponsePDU</span><span class="p">:</span>
</span><span data-line="370">                <span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</span><span data-line="371">                <span class="bp">self</span><span class="o">.</span><span class="n">_valid</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="372">                <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="373">            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span data-line="374">                <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid MMS response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">present</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span></div>

</span><span data-line="375">
</span><span data-line="376">    <span class="c1"># ---------------------------------------------------------------------- #</span>
</span><span data-line="377">    <span class="c1"># Data Exchange</span>
</span><span data-line="378">    <span class="c1"># ---------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="MMS_Connection.send_data">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.send_data">[docs]</a>
</span><span data-line="379">    <span class="nd">@override</span>
</span><span data-line="380">    <span class="k">def</span><span class="w"> </span><span class="nf">send_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">octets</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="381"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="382"><span class="sd">        Send raw BER-encoded MMS data.</span>
</span><span data-line="383">
</span><span data-line="384"><span class="sd">        :param octets: BER-encoded MMS PDU.</span>
</span><span data-line="385"><span class="sd">        :type octets: bytes</span>
</span><span data-line="386"><span class="sd">        :raises AssertionError: If the connection is not established.</span>
</span><span data-line="387"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="388">        <span class="bp">self</span><span class="o">.</span><span class="n">_assert_connected</span><span class="p">()</span>
</span><span data-line="389">        <span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">send_encoded_data</span><span class="p">(</span><span class="n">octets</span><span class="p">,</span> <span class="n">MMS_PRESENTATION_CONTEXT_ID</span><span class="p">)</span></div>

</span><span data-line="390">
<div class="viewcode-block" id="MMS_Connection.send_mms_data">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.send_mms_data">[docs]</a>
</span><span data-line="391">    <span class="k">def</span><span class="w"> </span><span class="nf">send_mms_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pdu</span><span class="p">:</span> <span class="n">MMSpdu</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="392"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="393"><span class="sd">        Send an MMS PDU after BER encoding.</span>
</span><span data-line="394">
</span><span data-line="395"><span class="sd">        :param pdu: MMS PDU to send.</span>
</span><span data-line="396"><span class="sd">        :type pdu: MMSpdu</span>
</span><span data-line="397"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="398">        <span class="bp">self</span><span class="o">.</span><span class="n">send_data</span><span class="p">(</span><span class="n">pdu</span><span class="o">.</span><span class="n">ber_encode</span><span class="p">())</span></div>

</span><span data-line="399">
<div class="viewcode-block" id="MMS_Connection.recv_mms_data">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.recv_mms_data">[docs]</a>
</span><span data-line="400">    <span class="k">def</span><span class="w"> </span><span class="nf">recv_mms_data</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MMSpdu</span><span class="p">:</span>
</span><span data-line="401"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="402"><span class="sd">        Receive and decode an MMS PDU.</span>
</span><span data-line="403">
</span><span data-line="404"><span class="sd">        :return: Decoded MMS PDU.</span>
</span><span data-line="405"><span class="sd">        :rtype: MMSpdu</span>
</span><span data-line="406"><span class="sd">        :raises TypeError: If the received data is not an MMS PDU.</span>
</span><span data-line="407"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="408">        <span class="n">pdu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">presentation</span><span class="o">.</span><span class="n">recv_encoded_data</span><span class="p">()</span>
</span><span data-line="409">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">pdu</span><span class="p">,</span> <span class="n">MMSpdu</span><span class="p">):</span>
</span><span data-line="410">            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Received invalid MMS data: </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">pdu</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="411">        <span class="k">return</span> <span class="n">pdu</span></div>

</span><span data-line="412">
</span><span data-line="413">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="414">    <span class="c1"># 10 VMD Support Services</span>
</span><span data-line="415">    <span class="c1"># ---------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MMS_Connection.get_status">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.get_status">[docs]</a>
</span><span data-line="416">    <span class="k">def</span><span class="w"> </span><span class="nf">get_status</span><span class="p">(</span>
</span><span data-line="417">        <span class="bp">self</span><span class="p">,</span> <span class="n">ex_derivation</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="418">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span>
</span><span data-line="419">        <span class="n">StatusResponse</span><span class="o">.</span><span class="n">vmdLogicalStatus_VALUES</span><span class="p">,</span> <span class="n">StatusResponse</span><span class="o">.</span><span class="n">vmdPhysicalStatus_VALUES</span>
</span><span data-line="420">    <span class="p">]:</span>
</span><span data-line="421"><span class="w">        </span><span class="sd">&quot;&quot;&quot;10.3 Status Service</span>
</span><span data-line="422">
</span><span data-line="423"><span class="sd">        The *Status* service is used by an MMS client to determine the</span>
</span><span data-line="424"><span class="sd">        general condition or health of a VMD (Virtual Manufacturing Device).</span>
</span><span data-line="425">
</span><span data-line="426"><span class="sd">        :param ex_derivation: If ``True``, requests an *extended derivation*</span>
</span><span data-line="427"><span class="sd">                              of the status response. This influences how the</span>
</span><span data-line="428"><span class="sd">                              server derives the logical and physical VMD status</span>
</span><span data-line="429"><span class="sd">                              (see ISO 9506-1, 10.3.1.1.1).</span>
</span><span data-line="430"><span class="sd">        :type ex_derivation: bool</span>
</span><span data-line="431">
</span><span data-line="432"><span class="sd">        :returns: A tuple ``(logical_status, physical_status)``, where:</span>
</span><span data-line="433">
</span><span data-line="434"><span class="sd">            * ``logical_status`` is of type</span>
</span><span data-line="435"><span class="sd">              :class:`StatusResponse.vmdLogicalStatus_VALUES`.</span>
</span><span data-line="436"><span class="sd">            * ``physical_status`` is of type</span>
</span><span data-line="437"><span class="sd">              :class:`StatusResponse.vmdPhysicalStatus_VALUES`.</span>
</span><span data-line="438">
</span><span data-line="439"><span class="sd">        :rtype: tuple</span>
</span><span data-line="440">
</span><span data-line="441"><span class="sd">        Example:</span>
</span><span data-line="442">
</span><span data-line="443"><span class="sd">        &gt;&gt;&gt; logical, physical = mms_conn.get_status()</span>
</span><span data-line="444"><span class="sd">        &gt;&gt;&gt; print(f&quot;Logical VMD status: {logical!r}, Physical VMD status: {physical!r}&quot;)</span>
</span><span data-line="445"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="446">        <span class="n">request</span> <span class="o">=</span> <span class="n">Status_Request</span><span class="p">()</span>
</span><span data-line="447">        <span class="c1"># 10.3.1.1.1 Extended Derivation</span>
</span><span data-line="448">        <span class="c1"># This parameter, of type boolean, shall indicate which method is to be</span>
</span><span data-line="449">        <span class="c1"># used to derive the Status response.</span>
</span><span data-line="450">        <span class="n">request</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">ex_derivation</span>
</span><span data-line="451">
</span><span data-line="452">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">status</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="453">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="454">        <span class="n">status</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">status</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="455">        <span class="k">return</span> <span class="p">(</span><span class="n">status</span><span class="o">.</span><span class="n">vmdLogicalStatus</span><span class="p">,</span> <span class="n">status</span><span class="o">.</span><span class="n">vmdPhysicalStatus</span><span class="p">)</span></div>

</span><span data-line="456">
<div class="viewcode-block" id="MMS_Connection.get_name_list">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.get_name_list">[docs]</a>
</span><span data-line="457">    <span class="k">def</span><span class="w"> </span><span class="nf">get_name_list</span><span class="p">(</span>
</span><span data-line="458">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="459">        <span class="n">object_class</span><span class="p">:</span> <span class="n">ObjectClass</span><span class="p">,</span>
</span><span data-line="460">        <span class="n">scope</span><span class="p">:</span> <span class="n">ObjectScope</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="461">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="462"><span class="w">        </span><span class="sd">&quot;&quot;&quot;10.5 GetNameList Service</span>
</span><span data-line="463">
</span><span data-line="464"><span class="sd">        The *GetNameList* service requests the list (or a subset) of object</span>
</span><span data-line="465"><span class="sd">        names defined at the VMD. The server may return the list in segments</span>
</span><span data-line="466"><span class="sd">        if it is too long to fit in a single response.</span>
</span><span data-line="467">
</span><span data-line="468"><span class="sd">        :param object_class: The class of objects for which names are requested.</span>
</span><span data-line="469"><span class="sd">            For example: ``ObjectClass.namelist.domain``.</span>
</span><span data-line="470"><span class="sd">        :type object_class: ObjectClass</span>
</span><span data-line="471"><span class="sd">        :param scope: Optional scope of the name list request. If not provided,</span>
</span><span data-line="472"><span class="sd">            defaults to VMD-specific scope.</span>
</span><span data-line="473"><span class="sd">        :type scope: GetNameList_Request.objectScope_TYPE or None</span>
</span><span data-line="474">
</span><span data-line="475"><span class="sd">        :returns: A list of object identifiers.</span>
</span><span data-line="476"><span class="sd">        :rtype: list[str]</span>
</span><span data-line="477">
</span><span data-line="478"><span class="sd">        :raises ValueError: If the MMS server returns an invalid response.</span>
</span><span data-line="479">
</span><span data-line="480"><span class="sd">        Example:</span>
</span><span data-line="481">
</span><span data-line="482"><span class="sd">        &gt;&gt;&gt; domains = mms_conn.get_name_list(ObjectClass.domain)</span>
</span><span data-line="483"><span class="sd">        &gt;&gt;&gt; print(&quot;Available domains:&quot;, domains)</span>
</span><span data-line="484"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="485">        <span class="n">identifiers</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="486">        <span class="n">request</span> <span class="o">=</span> <span class="n">GetNameList_Request</span><span class="p">()</span>
</span><span data-line="487">        <span class="c1"># This parameter shall specify the object class of the object name to be</span>
</span><span data-line="488">        <span class="c1"># returned by the responding MMS-user.</span>
</span><span data-line="489">        <span class="n">request</span><span class="o">.</span><span class="n">objectClass</span> <span class="o">=</span> <span class="n">object_class</span>
</span><span data-line="490">
</span><span data-line="491">        <span class="c1"># This parameter shall indicate the scope of the object name list to be</span>
</span><span data-line="492">        <span class="c1"># returned.</span>
</span><span data-line="493">        <span class="k">if</span> <span class="n">scope</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="494">            <span class="n">scope</span> <span class="o">=</span> <span class="n">GetNameList_Request</span><span class="o">.</span><span class="n">objectScope_TYPE</span><span class="p">()</span>
</span><span data-line="495">            <span class="n">scope</span><span class="o">.</span><span class="n">vmdSpecific</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="496">
</span><span data-line="497">        <span class="n">request</span><span class="o">.</span><span class="n">objectScope</span> <span class="o">=</span> <span class="n">scope</span>
</span><span data-line="498">
</span><span data-line="499">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">getNameList</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="500">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="501">        <span class="n">name_list</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getNameList</span>
</span><span data-line="502">        <span class="k">if</span> <span class="n">name_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="503">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Received invalid GetNameList response&quot;</span><span class="p">)</span>
</span><span data-line="504">
</span><span data-line="505">        <span class="n">identifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">name_list</span><span class="o">.</span><span class="n">listOfIdentifier</span><span class="p">))</span>
</span><span data-line="506">        <span class="n">more_follows</span> <span class="o">=</span> <span class="n">name_list</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="507">        <span class="k">while</span> <span class="n">more_follows</span><span class="p">:</span>
</span><span data-line="508">            <span class="c1"># 10.5.1.2.2 More Follows</span>
</span><span data-line="509">            <span class="c1"># This parameter, of type boolean, shall indicate whether additional</span>
</span><span data-line="510">            <span class="c1"># GetNameList requests are necessary to retrieve all of the</span>
</span><span data-line="511">            <span class="c1"># requested information. If true, more requests are necessary (if</span>
</span><span data-line="512">            <span class="c1"># the MMS client wishes to retrieve more data).</span>
</span><span data-line="513">            <span class="n">request</span><span class="o">.</span><span class="n">continueAfter</span> <span class="o">=</span> <span class="n">identifiers</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="514">            <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">getNameList</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="515">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="516">            <span class="k">assert</span> <span class="n">response</span><span class="o">.</span><span class="n">present</span> <span class="o">==</span> <span class="n">ConfirmedServiceResponse</span><span class="o">.</span><span class="n">getNameList</span>
</span><span data-line="517">            <span class="n">identifiers</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getNameList</span><span class="o">.</span><span class="n">listOfIdentifier</span><span class="p">))</span>
</span><span data-line="518">            <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getNameList</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="519">
</span><span data-line="520">        <span class="k">return</span> <span class="n">identifiers</span></div>

</span><span data-line="521">
<div class="viewcode-block" id="MMS_Connection.identify">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.identify">[docs]</a>
</span><span data-line="522">    <span class="k">def</span><span class="w"> </span><span class="nf">identify</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
</span><span data-line="523"><span class="w">        </span><span class="sd">&quot;&quot;&quot;10.6 Identify Service</span>
</span><span data-line="524">
</span><span data-line="525"><span class="sd">        The *Identify* service retrieves the vendor, model, and revision</span>
</span><span data-line="526"><span class="sd">        information of the remote MMS VMD.</span>
</span><span data-line="527">
</span><span data-line="528"><span class="sd">        :returns: A tuple ``(vendor_name, model_name, revision)`` with all</span>
</span><span data-line="529"><span class="sd">            fields mandatory as per ISO 9506-2.</span>
</span><span data-line="530"><span class="sd">        :rtype: tuple[str, str, str]</span>
</span><span data-line="531">
</span><span data-line="532"><span class="sd">        &gt;&gt;&gt; vendor, model, revision = mms_conn.identify()</span>
</span><span data-line="533"><span class="sd">        &gt;&gt;&gt; print(f&quot;Device: {vendor} {model} (rev {revision})&quot;)</span>
</span><span data-line="534"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="535">        <span class="n">request</span> <span class="o">=</span> <span class="n">Identify_Request</span><span class="p">()</span>
</span><span data-line="536">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">identify</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="537">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="538">        <span class="n">identify</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">identify</span>
</span><span data-line="539">        <span class="k">return</span> <span class="p">(</span>
</span><span data-line="540">            <span class="n">identify</span><span class="o">.</span><span class="n">vendorName</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>  <span class="c1"># M (mandatory)</span>
</span><span data-line="541">            <span class="n">identify</span><span class="o">.</span><span class="n">modelName</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>  <span class="c1"># M (mandatory)</span>
</span><span data-line="542">            <span class="n">identify</span><span class="o">.</span><span class="n">revision</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>  <span class="c1"># M (mandatory)</span>
</span><span data-line="543">        <span class="p">)</span></div>

</span><span data-line="544">
<div class="viewcode-block" id="MMS_Connection.get_capabilities">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.get_capabilities">[docs]</a>
</span><span data-line="545">    <span class="k">def</span><span class="w"> </span><span class="nf">get_capabilities</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
</span><span data-line="546"><span class="w">        </span><span class="sd">&quot;&quot;&quot;10.8 GetCapabilityList Service</span>
</span><span data-line="547">
</span><span data-line="548"><span class="sd">        The *GetCapabilityList* service requests the list of services or</span>
</span><span data-line="549"><span class="sd">        features supported by the remote MMS server. Like *GetNameList*,</span>
</span><span data-line="550"><span class="sd">        the response may be segmented and require multiple follow-up requests.</span>
</span><span data-line="551">
</span><span data-line="552"><span class="sd">        :returns: A list of capability strings supported by the server.</span>
</span><span data-line="553"><span class="sd">        :rtype: list[str]</span>
</span><span data-line="554">
</span><span data-line="555"><span class="sd">        Example:</span>
</span><span data-line="556">
</span><span data-line="557"><span class="sd">        &gt;&gt;&gt; caps = mms_conn.get_capabilities()</span>
</span><span data-line="558"><span class="sd">        &gt;&gt;&gt; print(&quot;Server capabilities:&quot;, caps)</span>
</span><span data-line="559"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="560">        <span class="n">request</span> <span class="o">=</span> <span class="n">GetCapabilityList_Request</span><span class="p">()</span>
</span><span data-line="561">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">getCapabilityList</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="562">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="563">
</span><span data-line="564">        <span class="n">capabilities</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="565">        <span class="c1"># same as in get_name_list</span>
</span><span data-line="566">        <span class="n">capabilities</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getCapabilityList</span><span class="o">.</span><span class="n">listOfCapabilities</span><span class="p">))</span>
</span><span data-line="567">        <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getCapabilityList</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="568">        <span class="k">while</span> <span class="n">more_follows</span><span class="p">:</span>
</span><span data-line="569">            <span class="c1"># This parameter, of type boolean, shall indicate whether additional</span>
</span><span data-line="570">            <span class="c1"># GetCapabilityList requests are necessary to retrieve more of the</span>
</span><span data-line="571">            <span class="c1"># requested information.</span>
</span><span data-line="572">            <span class="n">service</span><span class="o">.</span><span class="n">getCapabilityList</span><span class="o">.</span><span class="n">continueAfter</span> <span class="o">=</span> <span class="n">capabilities</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="573">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="574">
</span><span data-line="575">            <span class="n">capabilities</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">getCapabilityList</span><span class="o">.</span><span class="n">listOfCapabilities</span><span class="p">))</span>
</span><span data-line="576">            <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">getCapabilityList</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="577">        <span class="k">return</span> <span class="n">capabilities</span></div>

</span><span data-line="578">
</span><span data-line="579">    <span class="k">def</span><span class="w"> </span><span class="nf">vmd_stop</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="580">        <span class="n">request</span> <span class="o">=</span> <span class="n">VMDStop_Request</span><span class="p">()</span>
</span><span data-line="581">        <span class="n">service</span> <span class="o">=</span> <span class="n">AdditionalService_Request</span><span class="p">(</span><span class="n">vMDStop</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="582">        <span class="c1"># request.value = None</span>
</span><span data-line="583">        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="584">
</span><span data-line="585">    <span class="k">def</span><span class="w"> </span><span class="nf">vmd_reset</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="586">        <span class="n">request</span> <span class="o">=</span> <span class="n">VMDReset_Request</span><span class="p">()</span>
</span><span data-line="587">        <span class="n">service</span> <span class="o">=</span> <span class="n">AdditionalService_Request</span><span class="p">(</span><span class="n">vMDReset</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="588">        <span class="c1"># request.value = None</span>
</span><span data-line="589">        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">additional_service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="590">
</span><span data-line="591">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="592">    <span class="c1"># 14 Variable Access Services</span>
</span><span data-line="593">    <span class="c1"># ---------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MMS_Connection.read_variables">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.read_variables">[docs]</a>
</span><span data-line="594">    <span class="k">def</span><span class="w"> </span><span class="nf">read_variables</span><span class="p">(</span>
</span><span data-line="595">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="596">        <span class="o">*</span><span class="n">pos_variables</span><span class="p">:</span> <span class="n">VariableAccessItem</span><span class="p">,</span>
</span><span data-line="597">        <span class="n">variables</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">VariableAccessItem</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="598">        <span class="n">spec_in_result</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span data-line="599">        <span class="n">list_name</span><span class="p">:</span> <span class="n">ObjectName</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span data-line="600">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">AccessResult</span><span class="p">]:</span>
</span><span data-line="601"><span class="w">        </span><span class="sd">&quot;&quot;&quot;14.6 Variable Read Service</span>
</span><span data-line="602">
</span><span data-line="603"><span class="sd">        Reads one or more variables or an entire variable list from the</span>
</span><span data-line="604"><span class="sd">        remote MMS server.</span>
</span><span data-line="605">
</span><span data-line="606"><span class="sd">        :param pos_variables: Positional list of variables to read.</span>
</span><span data-line="607"><span class="sd">        :type pos_variables: VariableAccessItem</span>
</span><span data-line="608"><span class="sd">        :param variables: Alternative way of specifying variables via keyword.</span>
</span><span data-line="609"><span class="sd">        :type variables: list[VariableAccessItem] or None</span>
</span><span data-line="610"><span class="sd">        :param spec_in_result: If ``True``, requests that the server return</span>
</span><span data-line="611"><span class="sd">            the *VariableAccessSpecification* in the response (14.6.1.1.1).</span>
</span><span data-line="612"><span class="sd">            Usually ``False`` for efficiency.</span>
</span><span data-line="613"><span class="sd">        :type spec_in_result: bool</span>
</span><span data-line="614"><span class="sd">        :param list_name: If set, references a named variable list to read</span>
</span><span data-line="615"><span class="sd">            instead of individual variables.</span>
</span><span data-line="616"><span class="sd">        :type list_name: ObjectName or None</span>
</span><span data-line="617">
</span><span data-line="618"><span class="sd">        :returns: A list of :class:`AccessResult` objects, one per variable read.</span>
</span><span data-line="619"><span class="sd">        :rtype: list[AccessResult]</span>
</span><span data-line="620">
</span><span data-line="621"><span class="sd">        :raises ValueError: If no variables or list_name is provided, or if both</span>
</span><span data-line="622"><span class="sd">            are specified at once.</span>
</span><span data-line="623">
</span><span data-line="624"><span class="sd">        Example (read two variables):</span>
</span><span data-line="625">
</span><span data-line="626"><span class="sd">        &gt;&gt;&gt; var1 = VariableAccessItem(name=ObjectName(vmd_specific=&quot;TempSensor1&quot;))</span>
</span><span data-line="627"><span class="sd">        &gt;&gt;&gt; var2 = VariableAccessItem(name=ObjectName(vmd_specific=&quot;TempSensor2&quot;))</span>
</span><span data-line="628"><span class="sd">        &gt;&gt;&gt; results = mms_conn.read_variables(var1, var2)</span>
</span><span data-line="629"><span class="sd">        &gt;&gt;&gt; for res in results:</span>
</span><span data-line="630"><span class="sd">        ...     print(res.success)  # AccessResult can be success or failure</span>
</span><span data-line="631"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="632">        <span class="n">variables</span> <span class="o">=</span> <span class="n">variables</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="633">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">pos_variables</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="634">            <span class="n">variables</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">pos_variables</span><span class="p">)</span>
</span><span data-line="635">
</span><span data-line="636">        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span data-line="637">            <span class="k">if</span> <span class="n">list_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="638">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span data-line="639">                    <span class="s2">&quot;Need at least one variable or a variable list name to read&quot;</span>
</span><span data-line="640">                <span class="p">)</span>
</span><span data-line="641">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="642">            <span class="k">if</span> <span class="n">list_name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="643">                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span data-line="644">                    <span class="s2">&quot;Can&#39;t specify both list of variables and variable list name&quot;</span>
</span><span data-line="645">                <span class="p">)</span>
</span><span data-line="646">
</span><span data-line="647">        <span class="n">request</span> <span class="o">=</span> <span class="n">Read_Request</span><span class="p">()</span>
</span><span data-line="648">        <span class="c1"># 14.6.1.1.1 Specification With Result</span>
</span><span data-line="649">        <span class="c1"># This boolean parameter shall indicate whether (true) or not (false) the</span>
</span><span data-line="650">        <span class="c1"># Variable Access Specification parameter is requested in the Result(+)</span>
</span><span data-line="651">        <span class="c1"># parameter of the response primitive, if issued.</span>
</span><span data-line="652">        <span class="n">request</span><span class="o">.</span><span class="n">specificationWithResult</span> <span class="o">=</span> <span class="n">spec_in_result</span>
</span><span data-line="653">        <span class="k">if</span> <span class="n">list_name</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="654">            <span class="n">request</span><span class="o">.</span><span class="n">variableAccessSpecification</span><span class="o">.</span><span class="n">listOfVariable</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">variables</span><span class="p">)</span>
</span><span data-line="655">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="656">            <span class="n">request</span><span class="o">.</span><span class="n">variableAccessSpecification</span><span class="o">.</span><span class="n">variableListName</span> <span class="o">=</span> <span class="n">list_name</span>
</span><span data-line="657">
</span><span data-line="658">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">read</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="659">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="660">        <span class="n">read_result</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span>
</span><span data-line="661">
</span><span data-line="662">        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">read_result</span><span class="o">.</span><span class="n">listOfAccessResult</span><span class="p">)</span></div>

</span><span data-line="663">
<div class="viewcode-block" id="MMS_Connection.write_variable">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.write_variable">[docs]</a>
</span><span data-line="664">    <span class="k">def</span><span class="w"> </span><span class="nf">write_variable</span><span class="p">(</span>
</span><span data-line="665">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="666">        <span class="n">variable</span><span class="p">:</span> <span class="n">VariableAccessSpecification</span><span class="o">.</span><span class="n">listOfVariable_TYPE</span><span class="o">.</span><span class="n">Member_TYPE</span><span class="p">,</span>
</span><span data-line="667">        <span class="n">value</span><span class="p">:</span> <span class="n">Data</span><span class="p">,</span>
</span><span data-line="668">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">DataAccessError</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="669"><span class="w">        </span><span class="sd">&quot;&quot;&quot;14.7 Variable Write Service</span>
</span><span data-line="670">
</span><span data-line="671"><span class="sd">        Writes the value of a single variable at the MMS server.</span>
</span><span data-line="672">
</span><span data-line="673"><span class="sd">        :param variable: The target variable to be written.</span>
</span><span data-line="674"><span class="sd">        :type variable: VariableAccessSpecification.listOfVariable_TYPE.Member_TYPE</span>
</span><span data-line="675"><span class="sd">        :param value: The value to write, encoded as MMS :class:`Data`.</span>
</span><span data-line="676"><span class="sd">        :type value: Data</span>
</span><span data-line="677">
</span><span data-line="678"><span class="sd">        :returns: ``None`` on success, or a :class:`DataAccessError` if the</span>
</span><span data-line="679"><span class="sd">            write failed for this variable.</span>
</span><span data-line="680"><span class="sd">        :rtype: DataAccessError or None</span>
</span><span data-line="681">
</span><span data-line="682"><span class="sd">        Example (write a new integer value):</span>
</span><span data-line="683">
</span><span data-line="684"><span class="sd">        &gt;&gt;&gt; var = VariableAccessItem(name=ObjectName(vmd_specific=&quot;SetPoint&quot;))</span>
</span><span data-line="685"><span class="sd">        &gt;&gt;&gt; data = Data()</span>
</span><span data-line="686"><span class="sd">        &gt;&gt;&gt; data.integer = 42</span>
</span><span data-line="687"><span class="sd">        &gt;&gt;&gt; err = mms_conn.write_variable(var, data)</span>
</span><span data-line="688"><span class="sd">        &gt;&gt;&gt; print(&quot;Write successful&quot; if err is None else f&quot;Failed: {err}&quot;)</span>
</span><span data-line="689"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="690">        <span class="n">request</span> <span class="o">=</span> <span class="n">Write_Request</span><span class="p">()</span>
</span><span data-line="691">        <span class="n">request</span><span class="o">.</span><span class="n">variableAccessSpecification</span><span class="o">.</span><span class="n">listOfVariable</span> <span class="o">=</span> <span class="p">[</span><span class="n">variable</span><span class="p">]</span>
</span><span data-line="692">        <span class="n">request</span><span class="o">.</span><span class="n">listOfData</span> <span class="o">=</span> <span class="p">[</span><span class="n">value</span><span class="p">]</span>
</span><span data-line="693">
</span><span data-line="694">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">write</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="695">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">,</span> <span class="n">need_response</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span data-line="696">        <span class="k">if</span> <span class="n">response</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="697">            <span class="n">write_results</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">write</span>
</span><span data-line="698">            <span class="c1"># this automatically returns None on success</span>
</span><span data-line="699">            <span class="k">return</span> <span class="n">write_results</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">failure</span><span class="o">.</span><span class="n">value</span></div>

</span><span data-line="700">
<div class="viewcode-block" id="MMS_Connection.variable_attributes">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.variable_attributes">[docs]</a>
</span><span data-line="701">    <span class="k">def</span><span class="w"> </span><span class="nf">variable_attributes</span><span class="p">(</span>
</span><span data-line="702">        <span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">ObjectName</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">address</span><span class="p">:</span> <span class="n">Address</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="703">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GetVariableAccessAttributes_Response</span><span class="p">:</span>
</span><span data-line="704"><span class="w">        </span><span class="sd">&quot;&quot;&quot;14.9 GetVariableAccessAttributes Service</span>
</span><span data-line="705">
</span><span data-line="706"><span class="sd">        Retrieves metadata describing a variable, such as its type,</span>
</span><span data-line="707"><span class="sd">        address, and whether it is deletable or modifiable.</span>
</span><span data-line="708">
</span><span data-line="709"><span class="sd">        :param name: The object name of the variable to query.</span>
</span><span data-line="710"><span class="sd">        :type name: ObjectName or None</span>
</span><span data-line="711"><span class="sd">        :param address: The variable&#39;s address (alternative to name).</span>
</span><span data-line="712"><span class="sd">        :type address: Address or None</span>
</span><span data-line="713">
</span><span data-line="714"><span class="sd">        :returns: The variable access attributes response from the MMS server.</span>
</span><span data-line="715"><span class="sd">        :rtype: GetVariableAccessAttributes_Response</span>
</span><span data-line="716">
</span><span data-line="717"><span class="sd">        :raises ValueError: If neither ``name`` nor ``address`` is specified,</span>
</span><span data-line="718"><span class="sd">            or if both are given at the same time.</span>
</span><span data-line="719">
</span><span data-line="720"><span class="sd">        Example (query attributes by name):</span>
</span><span data-line="721">
</span><span data-line="722"><span class="sd">        &gt;&gt;&gt; obj = ObjectName(vmd_specific=&quot;TempSensor1&quot;)</span>
</span><span data-line="723"><span class="sd">        &gt;&gt;&gt; attrs = mms_conn.variable_attributes(name=obj)</span>
</span><span data-line="724"><span class="sd">        &gt;&gt;&gt; print(&quot;Type description:&quot;, attrs.typeDescription)</span>
</span><span data-line="725"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="726">        <span class="k">if</span> <span class="ow">not</span> <span class="n">name</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">address</span><span class="p">:</span>
</span><span data-line="727">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Need either name or address&quot;</span><span class="p">)</span>
</span><span data-line="728">
</span><span data-line="729">        <span class="k">if</span> <span class="n">name</span> <span class="ow">and</span> <span class="n">address</span><span class="p">:</span>
</span><span data-line="730">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can&#39;t specify both name and address&quot;</span><span class="p">)</span>
</span><span data-line="731">
</span><span data-line="732">        <span class="n">request</span> <span class="o">=</span> <span class="n">GetVariableAccessAttributes_Request</span><span class="p">()</span>
</span><span data-line="733">        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
</span><span data-line="734">            <span class="n">request</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="735">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="736">            <span class="n">request</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
</span><span data-line="737">
</span><span data-line="738">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">getVariableAccessAttributes</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="739">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="740">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">getVariableAccessAttributes</span></div>

</span><span data-line="741">
</span><span data-line="742">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="743">    <span class="c1"># 11 Domain Services</span>
</span><span data-line="744">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="745">    <span class="k">def</span><span class="w"> </span><span class="nf">domain_get_attributes</span><span class="p">(</span>
</span><span data-line="746">        <span class="bp">self</span><span class="p">,</span> <span class="n">domain</span><span class="p">:</span> <span class="n">DomainName</span> <span class="o">|</span> <span class="nb">str</span>
</span><span data-line="747">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">GetDomainAttributes_Response</span><span class="p">:</span>
</span><span data-line="748">        <span class="n">request</span> <span class="o">=</span> <span class="n">GetDomainAttributes_Request</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span><span data-line="749">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">getDomainAttributes</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="750">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="751">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">getDomainAttributes</span>
</span><span data-line="752">
</span><span data-line="753">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="754">    <span class="c1"># Annex D - File Management</span>
</span><span data-line="755">    <span class="c1"># ---------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MMS_Connection.file_open">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_open">[docs]</a>
</span><span data-line="756">    <span class="k">def</span><span class="w"> </span><span class="nf">file_open</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileHandle</span><span class="p">:</span>
</span><span data-line="757"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.3 FileOpen Service</span>
</span><span data-line="758">
</span><span data-line="759"><span class="sd">        Opens a file in the MMS server&#39;s virtual filestore and returns a</span>
</span><span data-line="760"><span class="sd">        handle used for subsequent file operations (read, close, etc.).</span>
</span><span data-line="761">
</span><span data-line="762"><span class="sd">        :param name: The file name to open.</span>
</span><span data-line="763"><span class="sd">        :type name: FileName</span>
</span><span data-line="764"><span class="sd">        :param offset: Initial byte offset from which to start reading.</span>
</span><span data-line="765"><span class="sd">            Defaults to ``0`` (beginning of the file).</span>
</span><span data-line="766"><span class="sd">        :type offset: int, optional</span>
</span><span data-line="767">
</span><span data-line="768"><span class="sd">        :returns: A file handle including the FRSM ID and file attributes.</span>
</span><span data-line="769"><span class="sd">        :rtype: FileHandle</span>
</span><span data-line="770">
</span><span data-line="771"><span class="sd">        Example (complete):</span>
</span><span data-line="772"><span class="sd">        &gt;&gt;&gt; # Open a file for reading</span>
</span><span data-line="773"><span class="sd">        &gt;&gt;&gt; handle = mms_conn.file_open(FileName([&quot;/logs/system.log&quot;]))</span>
</span><span data-line="774"><span class="sd">        &gt;&gt;&gt; # Read complete file</span>
</span><span data-line="775"><span class="sd">        &gt;&gt;&gt; data = mms_conn.file_read(handle)</span>
</span><span data-line="776"><span class="sd">        &gt;&gt;&gt; print(data.decode(&quot;utf-8&quot;)[:200])  # show first 200 characters</span>
</span><span data-line="777"><span class="sd">        &gt;&gt;&gt; # Close the file handle</span>
</span><span data-line="778"><span class="sd">        &gt;&gt;&gt; mms_conn.file_close(handle)</span>
</span><span data-line="779"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="780">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileOpen_Request</span><span class="p">()</span>
</span><span data-line="781">        <span class="n">request</span><span class="o">.</span><span class="n">fileName</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="782">        <span class="n">request</span><span class="o">.</span><span class="n">initialPosition</span> <span class="o">=</span> <span class="n">offset</span>
</span><span data-line="783">
</span><span data-line="784">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileOpen</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="785">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="786">        <span class="n">handle</span> <span class="o">=</span> <span class="n">FileHandle</span><span class="p">(</span>
</span><span data-line="787">            <span class="n">response</span><span class="o">.</span><span class="n">fileOpen</span><span class="o">.</span><span class="n">frsmID</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">fileOpen</span><span class="o">.</span><span class="n">fileAttributes</span>
</span><span data-line="788">        <span class="p">)</span>
</span><span data-line="789">        <span class="k">return</span> <span class="n">handle</span></div>

</span><span data-line="790">
<div class="viewcode-block" id="MMS_Connection.file_read_chunk">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_read_chunk">[docs]</a>
</span><span data-line="791">    <span class="k">def</span><span class="w"> </span><span class="nf">file_read_chunk</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">FileHandle</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">bytes</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]:</span>
</span><span data-line="792"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.4 FileRead (chunked)</span>
</span><span data-line="793">
</span><span data-line="794"><span class="sd">        Reads a chunk of data from an open file handle.</span>
</span><span data-line="795">
</span><span data-line="796"><span class="sd">        :param handle: A :class:`FileHandle` or raw FRSM ID.</span>
</span><span data-line="797"><span class="sd">        :type handle: FileHandle or int</span>
</span><span data-line="798">
</span><span data-line="799"><span class="sd">        :returns: A tuple ``(data, more_follows)`` where:</span>
</span><span data-line="800"><span class="sd">            - ``data`` is a bytes object containing the chunk read.</span>
</span><span data-line="801"><span class="sd">            - ``more_follows`` is a boolean indicating if further reads are required.</span>
</span><span data-line="802"><span class="sd">        :rtype: tuple[bytes, bool]</span>
</span><span data-line="803">
</span><span data-line="804"><span class="sd">        &gt;&gt;&gt; chunk, more = mms_conn.file_read_chunk(handle)</span>
</span><span data-line="805"><span class="sd">        &gt;&gt;&gt; print(len(chunk), &quot;bytes read, more follows?&quot;, more)</span>
</span><span data-line="806"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="807">        <span class="n">fp</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">handle</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">FileHandle</span><span class="p">)</span> <span class="k">else</span> <span class="n">handle</span>
</span><span data-line="808">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileRead_Request</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</span><span data-line="809">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileRead</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="810">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="811">
</span><span data-line="812">        <span class="n">data</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">fileRead</span><span class="o">.</span><span class="n">fileData</span>
</span><span data-line="813">        <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">fileRead</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="814">        <span class="k">return</span> <span class="n">data</span><span class="p">,</span> <span class="nb">bool</span><span class="p">(</span><span class="n">more_follows</span><span class="p">)</span></div>

</span><span data-line="815">
<div class="viewcode-block" id="MMS_Connection.file_read">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_read">[docs]</a>
</span><span data-line="816">    <span class="k">def</span><span class="w"> </span><span class="nf">file_read</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">FileHandle</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span data-line="817"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.4 FileRead (complete)</span>
</span><span data-line="818">
</span><span data-line="819"><span class="sd">        Reads the entire content of a file by repeatedly fetching</span>
</span><span data-line="820"><span class="sd">        chunks until ``moreFollows`` is false.</span>
</span><span data-line="821">
</span><span data-line="822"><span class="sd">        :param handle: A :class:`FileHandle` or raw FRSM ID.</span>
</span><span data-line="823"><span class="sd">        :type handle: FileHandle or int</span>
</span><span data-line="824">
</span><span data-line="825"><span class="sd">        :returns: Complete file contents as bytes.</span>
</span><span data-line="826"><span class="sd">        :rtype: bytes</span>
</span><span data-line="827"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="828">        <span class="n">more_follows</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="829">        <span class="n">result</span> <span class="o">=</span> <span class="p">[]</span>
</span><span data-line="830">        <span class="k">while</span> <span class="n">more_follows</span><span class="p">:</span>
</span><span data-line="831">            <span class="n">chunk</span><span class="p">,</span> <span class="n">more_follows</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">file_read_chunk</span><span class="p">(</span><span class="n">handle</span><span class="p">)</span>
</span><span data-line="832">            <span class="n">result</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">chunk</span><span class="p">)</span>
</span><span data-line="833">
</span><span data-line="834">        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

</span><span data-line="835">
<div class="viewcode-block" id="MMS_Connection.file_close">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_close">[docs]</a>
</span><span data-line="836">    <span class="k">def</span><span class="w"> </span><span class="nf">file_close</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">handle</span><span class="p">:</span> <span class="n">FileHandle</span> <span class="o">|</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="837"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.5 FileClose Service</span>
</span><span data-line="838">
</span><span data-line="839"><span class="sd">        Closes an open file handle. This releases the FRSM ID</span>
</span><span data-line="840"><span class="sd">        allocated by the server.</span>
</span><span data-line="841">
</span><span data-line="842"><span class="sd">        :param handle: A :class:`FileHandle` or raw FRSM ID.</span>
</span><span data-line="843"><span class="sd">        :type handle: FileHandle or int</span>
</span><span data-line="844"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="845">        <span class="n">fp</span> <span class="o">=</span> <span class="n">handle</span><span class="o">.</span><span class="n">handle</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">handle</span><span class="p">,</span> <span class="n">FileHandle</span><span class="p">)</span> <span class="k">else</span> <span class="n">handle</span>
</span><span data-line="846">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileClose_Request</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
</span><span data-line="847">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileClose</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="848">        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span></div>

</span><span data-line="849">
<div class="viewcode-block" id="MMS_Connection.file_rename">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_rename">[docs]</a>
</span><span data-line="850">    <span class="k">def</span><span class="w"> </span><span class="nf">file_rename</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">old_name</span><span class="p">:</span> <span class="n">FileName</span><span class="p">,</span> <span class="n">new_name</span><span class="p">:</span> <span class="n">FileName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="851"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.6 FileRename Service</span>
</span><span data-line="852">
</span><span data-line="853"><span class="sd">        Renames a file in the server&#39;s virtual filestore.</span>
</span><span data-line="854">
</span><span data-line="855"><span class="sd">        :param old_name: The current file name.</span>
</span><span data-line="856"><span class="sd">        :type old_name: FileName</span>
</span><span data-line="857"><span class="sd">        :param new_name: The new file name to assign.</span>
</span><span data-line="858"><span class="sd">        :type new_name: FileName</span>
</span><span data-line="859">
</span><span data-line="860"><span class="sd">        Example:</span>
</span><span data-line="861">
</span><span data-line="862"><span class="sd">        &gt;&gt;&gt; mms_conn.file_rename(FileName([&quot;/logs/old.log&quot;]),</span>
</span><span data-line="863"><span class="sd">        ...                      FileName([&quot;/logs/new.log&quot;]))</span>
</span><span data-line="864"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="865">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileRename_Request</span><span class="p">(</span><span class="n">currentFileName</span><span class="o">=</span><span class="n">old_name</span><span class="p">,</span> <span class="n">newFileName</span><span class="o">=</span><span class="n">new_name</span><span class="p">)</span>
</span><span data-line="866">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileRename</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="867">        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span></div>

</span><span data-line="868">
<div class="viewcode-block" id="MMS_Connection.file_delete">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.file_delete">[docs]</a>
</span><span data-line="869">    <span class="k">def</span><span class="w"> </span><span class="nf">file_delete</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">FileName</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="870"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.7 FileDelete Service</span>
</span><span data-line="871">
</span><span data-line="872"><span class="sd">        Deletes a file from the MMS server&#39;s virtual filestore.</span>
</span><span data-line="873">
</span><span data-line="874"><span class="sd">        :param name: The file name to delete.</span>
</span><span data-line="875"><span class="sd">        :type name: FileName</span>
</span><span data-line="876">
</span><span data-line="877"><span class="sd">        Example:</span>
</span><span data-line="878">
</span><span data-line="879"><span class="sd">        &gt;&gt;&gt; mms_conn.file_delete(FileName([&quot;/logs/obsolete.log&quot;]))</span>
</span><span data-line="880"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="881">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileDelete_Request</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span data-line="882">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileDelete</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="883">        <span class="n">_</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span></div>

</span><span data-line="884">
<div class="viewcode-block" id="MMS_Connection.list_directory">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.list_directory">[docs]</a>
</span><span data-line="885">    <span class="k">def</span><span class="w"> </span><span class="nf">list_directory</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="n">FileName</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">DirectoryEntry</span><span class="p">]:</span>
</span><span data-line="886"><span class="w">        </span><span class="sd">&quot;&quot;&quot;D.8 FileDirectory Service</span>
</span><span data-line="887">
</span><span data-line="888"><span class="sd">        Retrieves directory listings or file attributes from the</span>
</span><span data-line="889"><span class="sd">        server&#39;s virtual filestore.</span>
</span><span data-line="890">
</span><span data-line="891"><span class="sd">        :param name: Optional file or directory name pattern. If omitted,</span>
</span><span data-line="892"><span class="sd">            the server returns an implementation-defined default set.</span>
</span><span data-line="893"><span class="sd">        :type name: FileName or None</span>
</span><span data-line="894">
</span><span data-line="895"><span class="sd">        :returns: List of directory entries, possibly spanning multiple responses.</span>
</span><span data-line="896"><span class="sd">        :rtype: list[DirectoryEntry]</span>
</span><span data-line="897">
</span><span data-line="898"><span class="sd">        Example:</span>
</span><span data-line="899">
</span><span data-line="900"><span class="sd">        &gt;&gt;&gt; entries = mms_conn.list_directory()</span>
</span><span data-line="901"><span class="sd">        &gt;&gt;&gt; for e in entries:</span>
</span><span data-line="902"><span class="sd">        ...     print(e.fileName[0], e.fileAttributes.fileSize)</span>
</span><span data-line="903"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="904">        <span class="n">request</span> <span class="o">=</span> <span class="n">FileDirectory_Request</span><span class="p">()</span>
</span><span data-line="905">        <span class="c1"># D.8.1.1.1 File Specification</span>
</span><span data-line="906">        <span class="c1"># This optional parameter, of type FileName, shall, when present,</span>
</span><span data-line="907">        <span class="c1"># identify a file or group of files in the MMS server&#39;s virtual</span>
</span><span data-line="908">        <span class="c1"># filestore whose attributes are desired. Omission of this parameter</span>
</span><span data-line="909">        <span class="c1"># shall indicate that the attributes of an implementation defined</span>
</span><span data-line="910">        <span class="c1"># default group of files are being requested.</span>
</span><span data-line="911">        <span class="k">if</span> <span class="n">name</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="912">            <span class="n">request</span><span class="o">.</span><span class="n">fileSpecification</span> <span class="o">=</span> <span class="n">name</span>
</span><span data-line="913">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="914">            <span class="n">request</span><span class="o">.</span><span class="n">fileSpecification</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="915">
</span><span data-line="916">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">fileDirectory</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="917">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="918">        <span class="n">entries</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">fileDirectory</span><span class="o">.</span><span class="n">listOfDirectoryEntry</span><span class="p">)</span>
</span><span data-line="919">        <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">fileDirectory</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="920">        <span class="k">while</span> <span class="n">more_follows</span><span class="p">:</span>
</span><span data-line="921">            <span class="n">request</span><span class="o">.</span><span class="n">continueAfter</span> <span class="o">=</span> <span class="n">entries</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span data-line="922">            <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="923">            <span class="n">entries</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">response</span><span class="o">.</span><span class="n">fileDirectory</span><span class="o">.</span><span class="n">listOfDirectoryEntry</span><span class="p">))</span>
</span><span data-line="924">            <span class="n">more_follows</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">fileDirectory</span><span class="o">.</span><span class="n">moreFollows</span>
</span><span data-line="925">        <span class="k">return</span> <span class="n">entries</span></div>

</span><span data-line="926">
</span><span data-line="927">    <span class="c1"># ---------------------------------------------------------------------------</span>
</span><span data-line="928">    <span class="c1"># Service Requests</span>
</span><span data-line="929">    <span class="c1"># ---------------------------------------------------------------------------</span>
<div class="viewcode-block" id="MMS_Connection.additional_service_request">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.additional_service_request">[docs]</a>
</span><span data-line="930">    <span class="k">def</span><span class="w"> </span><span class="nf">additional_service_request</span><span class="p">(</span>
</span><span data-line="931">        <span class="bp">self</span><span class="p">,</span> <span class="n">request</span><span class="p">:</span> <span class="n">AdditionalService_Request</span>
</span><span data-line="932">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">AdditionalService_Response</span><span class="p">:</span>
</span><span data-line="933"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="934"><span class="sd">        Issues an MMS **Additional Service** request (ISO 9506-1:1990, Clause 19).</span>
</span><span data-line="935">
</span><span data-line="936"><span class="sd">        This is a specialized helper that wraps an</span>
</span><span data-line="937"><span class="sd">        :class:`~AdditionalService_Request` in a</span>
</span><span data-line="938"><span class="sd">        :class:`~ConfirmedServiceRequest` and dispatches it via</span>
</span><span data-line="939"><span class="sd">        :meth:`service_request`.</span>
</span><span data-line="940">
</span><span data-line="941"><span class="sd">        It is rarely used directly, but provides a template for invoking</span>
</span><span data-line="942"><span class="sd">        &quot;non-standardized&quot; or vendor-specific services.</span>
</span><span data-line="943">
</span><span data-line="944"><span class="sd">        :param request: The additional service request to send.</span>
</span><span data-line="945"><span class="sd">        :type request: AdditionalService_Request</span>
</span><span data-line="946">
</span><span data-line="947"><span class="sd">        :returns: The decoded additional service response from the server.</span>
</span><span data-line="948"><span class="sd">        :rtype: AdditionalService_Response</span>
</span><span data-line="949">
</span><span data-line="950"><span class="sd">        Example:</span>
</span><span data-line="951">
</span><span data-line="952"><span class="sd">        &gt;&gt;&gt; req = AdditionalService_Request()</span>
</span><span data-line="953"><span class="sd">        &gt;&gt;&gt; # populate request with service-specific fields</span>
</span><span data-line="954"><span class="sd">        &gt;&gt;&gt; resp = mms_conn.additional_service_request(req)</span>
</span><span data-line="955"><span class="sd">        &gt;&gt;&gt; print(resp)</span>
</span><span data-line="956"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="957">        <span class="n">service</span> <span class="o">=</span> <span class="n">ConfirmedServiceRequest</span><span class="p">(</span><span class="n">additionalService</span><span class="o">=</span><span class="n">request</span><span class="p">)</span>
</span><span data-line="958">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">service_request</span><span class="p">(</span><span class="n">service</span><span class="p">)</span>
</span><span data-line="959">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">additionalService</span></div>

</span><span data-line="960">
<div class="viewcode-block" id="MMS_Connection.service_request">
<a class="viewcode-back" href="../../../../protocols/mms/api_conn.html#icspacket.proto.mms.connection.MMS_Connection.service_request">[docs]</a>
</span><span data-line="961">    <span class="k">def</span><span class="w"> </span><span class="nf">service_request</span><span class="p">(</span>
</span><span data-line="962">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="963">        <span class="n">request</span><span class="p">:</span> <span class="n">ConfirmedServiceRequest</span><span class="p">,</span>
</span><span data-line="964">        <span class="n">need_response</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span data-line="965">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ConfirmedServiceResponse</span><span class="p">:</span>
</span><span data-line="966"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="967"><span class="sd">        Issues a **generic MMS Confirmed Service Request** and returns</span>
</span><span data-line="968"><span class="sd">        the corresponding Confirmed Service Response.</span>
</span><span data-line="969">
</span><span data-line="970"><span class="sd">        This is the central method through which *all* MMS services</span>
</span><span data-line="971"><span class="sd">        are ultimately invoked. Higher-level convenience wrappers</span>
</span><span data-line="972"><span class="sd">        (e.g., :meth:`read_variables`, :meth:`file_open`, etc.)</span>
</span><span data-line="973"><span class="sd">        construct the appropriate</span>
</span><span data-line="974"><span class="sd">        :class:`~ConfirmedServiceRequest` and delegate to this method.</span>
</span><span data-line="975">
</span><span data-line="976"><span class="sd">        **Workflow:**</span>
</span><span data-line="977">
</span><span data-line="978"><span class="sd">        1. A new :class:`Confirmed_RequestPDU` is allocated and</span>
</span><span data-line="979"><span class="sd">            tagged with the next available ``invokeID``.</span>
</span><span data-line="980"><span class="sd">        2. The caller-supplied ``request`` is embedded into the PDU.</span>
</span><span data-line="981"><span class="sd">        3. The request is wrapped into an :class:`MMSpdu`.</span>
</span><span data-line="982"><span class="sd">        4. Transmission is performed using</span>
</span><span data-line="983"><span class="sd">            :meth:`send_mms_data`.</span>
</span><span data-line="984"><span class="sd">        5. A response is awaited via :meth:`recv_mms_data`.</span>
</span><span data-line="985"><span class="sd">        6. Any detected service error is normalized using</span>
</span><span data-line="986"><span class="sd">            :meth:`_error_from_service_response`.</span>
</span><span data-line="987"><span class="sd">        7. The decoded :class:`ConfirmedServiceResponse`</span>
</span><span data-line="988"><span class="sd">            is returned to the caller.</span>
</span><span data-line="989">
</span><span data-line="990"><span class="sd">        :param request: The service request PDU, e.g.</span>
</span><span data-line="991"><span class="sd">            :class:`Read_Request`, :class:`FileOpen_Request`, etc.,</span>
</span><span data-line="992"><span class="sd">            wrapped in a :class:`ConfirmedServiceRequest`.</span>
</span><span data-line="993"><span class="sd">        :type request: ConfirmedServiceRequest</span>
</span><span data-line="994">
</span><span data-line="995"><span class="sd">        :param need_response: Whether a response is required.</span>
</span><span data-line="996"><span class="sd">            If ``False``, the method will still wait for the server</span>
</span><span data-line="997"><span class="sd">            response (ISO 9506-2 requires this) but certain services</span>
</span><span data-line="998"><span class="sd">            may ignore the payload.</span>
</span><span data-line="999"><span class="sd">        :type need_response: bool, optional</span>
</span><span data-line="1000">
</span><span data-line="1001"><span class="sd">        :raises MMSConnectionError: If the response indicates a service error.</span>
</span><span data-line="1002"><span class="sd">        :raises MMSServiceError: For generic or protocol-level failures.</span>
</span><span data-line="1003"><span class="sd">        :raises MMSUnknownServiceError: If the service response cannot</span>
</span><span data-line="1004"><span class="sd">            be mapped to a known type.</span>
</span><span data-line="1005">
</span><span data-line="1006"><span class="sd">        :returns: The ``service`` component of the decoded</span>
</span><span data-line="1007"><span class="sd">            :class:`ConfirmedServiceResponse`, containing the</span>
</span><span data-line="1008"><span class="sd">            service-specific result (e.g. a :class:`Read_Response`).</span>
</span><span data-line="1009"><span class="sd">        :rtype: ConfirmedServiceResponse</span>
</span><span data-line="1010">
</span><span data-line="1011"><span class="sd">        Example:</span>
</span><span data-line="1012">
</span><span data-line="1013"><span class="sd">        &gt;&gt;&gt; # Manually constructing a Read request</span>
</span><span data-line="1014"><span class="sd">        &gt;&gt;&gt; read_req = Read_Request()</span>
</span><span data-line="1015"><span class="sd">        &gt;&gt;&gt; read_req.variableAccessSpecification.listOfVariable = [var]</span>
</span><span data-line="1016"><span class="sd">        &gt;&gt;&gt; csr = ConfirmedServiceRequest(read=read_req)</span>
</span><span data-line="1017"><span class="sd">        &gt;&gt;&gt; resp = mms_conn.service_request(csr)</span>
</span><span data-line="1018"><span class="sd">        &gt;&gt;&gt; print(resp.read.listOfAccessResult)</span>
</span><span data-line="1019"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="1020">        <span class="n">pdu</span> <span class="o">=</span> <span class="n">Confirmed_RequestPDU</span><span class="p">()</span>
</span><span data-line="1021">        <span class="n">pdu</span><span class="o">.</span><span class="n">invokeID</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">next_invoke_id</span>
</span><span data-line="1022">        <span class="n">pdu</span><span class="o">.</span><span class="n">service</span> <span class="o">=</span> <span class="n">request</span>
</span><span data-line="1023">
</span><span data-line="1024">        <span class="n">mms_pdu</span> <span class="o">=</span> <span class="n">MMSpdu</span><span class="p">(</span><span class="n">confirmed_RequestPDU</span><span class="o">=</span><span class="n">pdu</span><span class="p">)</span>
</span><span data-line="1025">        <span class="bp">self</span><span class="o">.</span><span class="n">send_mms_data</span><span class="p">(</span><span class="n">mms_pdu</span><span class="p">)</span>
</span><span data-line="1026">        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">recv_mms_data</span><span class="p">()</span>
</span><span data-line="1027">        <span class="n">error</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_from_service_response</span><span class="p">(</span><span class="n">request</span><span class="p">,</span> <span class="n">response</span><span class="p">,</span> <span class="n">need_response</span><span class="p">)</span>
</span><span data-line="1028">        <span class="k">if</span> <span class="n">error</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1029">            <span class="k">raise</span> <span class="n">error</span>
</span><span data-line="1030">
</span><span data-line="1031">        <span class="k">return</span> <span class="n">response</span><span class="o">.</span><span class="n">confirmed_ResponsePDU</span><span class="o">.</span><span class="n">service</span></div>

</span><span data-line="1032">
</span><span data-line="1033">    <span class="c1"># --- private ugly code</span>
</span><span data-line="1034">    <span class="k">def</span><span class="w"> </span><span class="nf">_error_from_service_response</span><span class="p">(</span>
</span><span data-line="1035">        <span class="bp">self</span><span class="p">,</span>
</span><span data-line="1036">        <span class="n">request</span><span class="p">:</span> <span class="n">ConfirmedServiceRequest</span><span class="p">,</span>
</span><span data-line="1037">        <span class="n">response</span><span class="p">:</span> <span class="n">MMSpdu</span><span class="p">,</span>
</span><span data-line="1038">        <span class="n">need_response</span><span class="p">:</span> <span class="nb">bool</span><span class="p">,</span>
</span><span data-line="1039">    <span class="p">)</span> <span class="o">-&gt;</span> <span class="ne">Exception</span> <span class="o">|</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="1040">        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">present</span> <span class="o">==</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_confirmed_ErrorPDU</span><span class="p">:</span>
</span><span data-line="1041">            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_error_from_pdu</span><span class="p">(</span>
</span><span data-line="1042">                <span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">response</span><span class="o">.</span><span class="n">confirmed_ErrorPDU</span>
</span><span data-line="1043">            <span class="p">)</span>
</span><span data-line="1044">
</span><span data-line="1045">        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">present</span> <span class="o">==</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_rejectPDU</span><span class="p">:</span>
</span><span data-line="1046">            <span class="c1"># unknown service</span>
</span><span data-line="1047">            <span class="n">reason</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">rejectPDU</span><span class="o">.</span><span class="n">rejectReason</span>
</span><span data-line="1048">            <span class="k">assert</span> <span class="p">(</span>
</span><span data-line="1049">                <span class="n">reason</span><span class="o">.</span><span class="n">present</span>
</span><span data-line="1050">                <span class="o">==</span> <span class="n">RejectPDU</span><span class="o">.</span><span class="n">rejectReason_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_confirmed_requestPDU</span>
</span><span data-line="1051">            <span class="p">)</span>
</span><span data-line="1052">            <span class="k">match</span> <span class="n">reason</span><span class="o">.</span><span class="n">confirmed_requestPDU</span><span class="p">:</span>
</span><span data-line="1053">                <span class="k">case</span> <span class="n">RejectPDU</span><span class="o">.</span><span class="n">rejectReason_TYPE</span><span class="o">.</span><span class="n">confirmed_requestPDU_VALUES</span><span class="o">.</span><span class="n">V_unrecognized_service</span><span class="p">:</span>
</span><span data-line="1054">                    <span class="k">return</span> <span class="n">MMSUnknownServiceError</span><span class="p">(</span>
</span><span data-line="1055">                        <span class="sa">f</span><span class="s2">&quot;Peer rejected unrecognized service request of type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="o">.</span><span class="n">name</span><span class="p">[</span><span class="mi">3</span><span class="p">:]</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span data-line="1056">                    <span class="p">)</span>
</span><span data-line="1057">                <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span data-line="1058">                    <span class="k">return</span> <span class="n">MMSServiceError</span><span class="p">(</span>
</span><span data-line="1059">                        <span class="sa">f</span><span class="s2">&quot;Failed service request of type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2"> with &quot;</span>
</span><span data-line="1060">                        <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;reason: </span><span class="si">{</span><span class="n">reason</span><span class="o">.</span><span class="n">confirmed_requestPDU</span><span class="si">}</span><span class="s2">&quot;</span>
</span><span data-line="1061">                    <span class="p">)</span>
</span><span data-line="1062">
</span><span data-line="1063">        <span class="k">if</span> <span class="n">response</span><span class="o">.</span><span class="n">present</span> <span class="o">!=</span> <span class="n">MMSpdu</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_confirmed_ResponsePDU</span><span class="p">:</span>
</span><span data-line="1064">            <span class="k">if</span> <span class="ow">not</span> <span class="n">need_response</span><span class="p">:</span>
</span><span data-line="1065">                <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1066">
</span><span data-line="1067">            <span class="k">return</span> <span class="n">MMSServiceError</span><span class="p">(</span>
</span><span data-line="1068">                <span class="sa">f</span><span class="s2">&quot;Received invalid MMS response: </span><span class="si">{</span><span class="n">response</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2"> - &quot;</span>
</span><span data-line="1069">                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;expected response for </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span data-line="1070">            <span class="p">)</span>
</span><span data-line="1071">
</span><span data-line="1072">        <span class="n">pdu</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">confirmed_ResponsePDU</span>
</span><span data-line="1073">        <span class="k">if</span> <span class="ow">not</span> <span class="n">pdu</span><span class="p">:</span>
</span><span data-line="1074">            <span class="k">return</span> <span class="n">MMSServiceError</span><span class="p">(</span>
</span><span data-line="1075">                <span class="sa">f</span><span class="s2">&quot;Failed service request of type: </span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2"> (empty response)&quot;</span>
</span><span data-line="1076">            <span class="p">)</span>
</span><span data-line="1077">
</span><span data-line="1078">        <span class="k">if</span> <span class="n">pdu</span><span class="o">.</span><span class="n">invokeID</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">invoke_id</span><span class="p">:</span>
</span><span data-line="1079">            <span class="k">return</span> <span class="n">MMSServiceError</span><span class="p">(</span>
</span><span data-line="1080">                <span class="sa">f</span><span class="s2">&quot;Response invokeID (</span><span class="si">{</span><span class="n">pdu</span><span class="o">.</span><span class="n">invokeID</span><span class="si">}</span><span class="s2">) does not match &quot;</span>
</span><span data-line="1081">                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;request invokeID (</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">invoke_id</span><span class="si">}</span><span class="s2">)&quot;</span>
</span><span data-line="1082">            <span class="p">)</span>
</span><span data-line="1083">
</span><span data-line="1084">        <span class="k">if</span> <span class="n">pdu</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">present</span> <span class="o">!=</span> <span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="p">:</span>
</span><span data-line="1085">            <span class="k">return</span> <span class="n">MMSServiceError</span><span class="p">(</span>
</span><span data-line="1086">                <span class="sa">f</span><span class="s2">&quot;Response service type (</span><span class="si">{</span><span class="n">pdu</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2">) does not match &quot;</span>
</span><span data-line="1087">                <span class="o">+</span> <span class="sa">f</span><span class="s2">&quot;request service type (</span><span class="si">{</span><span class="n">request</span><span class="o">.</span><span class="n">present</span><span class="si">!r}</span><span class="s2">)&quot;</span>
</span><span data-line="1088">            <span class="p">)</span>
</span><span data-line="1089">
</span><span data-line="1090">        <span class="k">return</span> <span class="kc">None</span>
</span><span data-line="1091">
</span><span data-line="1092">    <span class="k">def</span><span class="w"> </span><span class="nf">_error_from_pdu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">errpr_pdu</span><span class="p">:</span> <span class="n">Confirmed_ErrorPDU</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="ne">Exception</span><span class="p">:</span>
</span><span data-line="1093">        <span class="n">error</span> <span class="o">=</span> <span class="n">errpr_pdu</span><span class="o">.</span><span class="n">serviceError</span>
</span><span data-line="1094">        <span class="n">class_</span> <span class="o">=</span> <span class="n">error</span><span class="o">.</span><span class="n">errorClass</span>
</span><span data-line="1095">        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">class_</span><span class="o">.</span><span class="n">present</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">: Failed request of type </span><span class="si">{</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span>
</span><span data-line="1096">        <span class="c1"># fmt: off</span>
</span><span data-line="1097">        <span class="k">match</span><span class="w"> </span><span class="n">class</span><span class="k">_</span><span class="o">.</span><span class="n">present</span><span class="p">:</span>
</span><span data-line="1098">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_vmd_state</span><span class="p">:</span>
</span><span data-line="1099">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">vmd_state</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1100">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_application_reference</span><span class="p">:</span>
</span><span data-line="1101">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">application_reference</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1102">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_definition</span><span class="p">:</span>
</span><span data-line="1103">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">definition</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1104">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_resource</span><span class="p">:</span>
</span><span data-line="1105">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">resource</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1106">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_service</span><span class="p">:</span>
</span><span data-line="1107">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">service</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1108">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_service_preempt</span><span class="p">:</span>
</span><span data-line="1109">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">service_preempt</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1110">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_time_resolution</span><span class="p">:</span>
</span><span data-line="1111">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">time_resolution</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1112">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_access</span><span class="p">:</span>
</span><span data-line="1113">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">access</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1114">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_initiate</span><span class="p">:</span>
</span><span data-line="1115">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">initiate</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1116">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_conclude</span><span class="p">:</span>
</span><span data-line="1117">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">conclude</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1118">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_cancel</span><span class="p">:</span>
</span><span data-line="1119">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">cancel</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1120">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_file</span><span class="p">:</span>
</span><span data-line="1121">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">file</span><span class="o">.</span><span class="n">name</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1122">            <span class="k">case</span> <span class="n">ServiceError</span><span class="o">.</span><span class="n">errorClass_TYPE</span><span class="o">.</span><span class="n">PRESENT</span><span class="o">.</span><span class="n">PR_others</span><span class="p">:</span>
</span><span data-line="1123">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">msg</span><span class="si">}</span><span class="s2">, reason: </span><span class="si">{</span><span class="n">error</span><span class="o">.</span><span class="n">errorClass</span><span class="o">.</span><span class="n">others</span><span class="si">!r}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span data-line="1124">            <span class="k">case</span><span class="w"> </span><span class="k">_</span><span class="p">:</span>
</span><span data-line="1125">                <span class="k">return</span> <span class="n">MMSConnectionError</span><span class="p">(</span><span class="n">error</span><span class="p">,</span> <span class="n">msg</span><span class="p">)</span></div>

</span><span data-line="1126">        <span class="c1"># fmt: on</span>
</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, MatrixEditor</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/MatrixEditor/icspacket" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../../_static/documentation_options.js?v=89082e11"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../../../_static/shibuya.js?v=e730760c"></script></body>
</html>