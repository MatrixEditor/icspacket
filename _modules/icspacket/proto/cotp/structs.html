<!DOCTYPE html>
<html lang="en" data-accent-color="lime" data-content_root="../../../../">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0"><title>icspacket.proto.cotp.structs - icspacket 0.2.2 documentation</title><link rel="index" title="Index" href="../../../../genindex.html" /><link rel="search" title="Search" href="../../../../search.html" />
      <link rel="canonical" href="https://matrixeditor.github.io/icspacket/_modules/icspacket/proto/cotp/structs.html" /><script>
    function setColorMode(t){let e=document.documentElement;e.setAttribute("data-color-mode",t);let a=window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches,s=t;"auto"===t&&(s=a?"dark":"light"),"light"===s?(e.classList.remove("dark"),e.classList.add("light")):(e.classList.remove("light"),e.classList.add("dark"))}
    setColorMode(localStorage._theme||"dark");
  </script><link rel="stylesheet" type="text/css" href="../../../../_static/pygments.css?v=397bb51e" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/shibuya.css?v=d48c410d" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../../../_static/sphinx-design.min.css?v=95c83b7e" />
    <link media="print" rel="stylesheet" type="text/css" href="../../../../_static/print.css?v=20ff2c19" />
    <link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root {
  --sy-f-text: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
  --sy-f-heading: "Inter", var(--sy-f-sys), var(--sy-f-cjk), sans-serif;
}
</style>
    <meta property="og:type" content="website"/>
<meta property="og:url" content="https://matrixeditor.github.io/icspacket/_modules/icspacket/proto/cotp/structs.html"/>
<meta property="og:title" content="icspacket.proto.cotp.structs"/>
<meta name="twitter:card" content="summary"/>
  </head>
<body><div class="sy-head">
  <div class="sy-head-blur"></div>
  <div class="sy-head-inner sy-container mx-auto">
    <a class="sy-head-brand" href="../../../../index.html">
      
      
      <strong>icspacket</strong>
    </a>
    <div class="sy-head-nav" id="head-nav">
      <nav class="sy-head-links"><ul>
      <li class="link"><a class="js-menu" href="../../../../getting-started/protocols.html" id="nav-trigger-1" aria-controls="nav-children-1">
            <span>Examples</span>
            <i class="i-lucide chevron-down"></i>
          </a>
        <ul id="nav-children-1" aria-labelledby="nav-trigger-1"><li><a href="../../../../protocols/mms/examples.html">
                <span>MMS Utilities</span>
                <small>Manufacturing Message Specification tools</small>
              </a></li><li><a href="../../../../protocols/dnp3/examples.html">
                <span>DNP3 Tools</span>
                <small>DNP3 utilities and tools</small>
              </a></li><li><a href="../../../../protocols/iec61850/iedmap.html">
                <span>IED Enumeration Tool</span>
                <small>Logical Device enumeration and more</small>
              </a></li></ul>
      </li></ul></nav>
      <div class="sy-head-extra flex items-center print:hidden"><form class="searchbox flex items-center" action="../../../../search.html" method="get">
  <input type="text" name="q" placeholder="Search" />
  <kbd>/</kbd>
</form><div class="sy-head-socials">
  <a href="https://github.com/MatrixEditor/icspacket" aria-label="GitHub">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </a></div></div>
    </div>
    <div class="sy-head-actions flex items-center shrink-0 print:hidden"><button class="js-theme theme-switch flex items-center"
data-aria-auto="Switch to light color mode"
data-aria-light="Switch to dark color mode"
data-aria-dark="Switch to auto color mode">
<i class="i-lucide theme-icon"></i>
</button><button class="md:hidden flex items-center js-menu" aria-label="Menu" type="button" aria-controls="head-nav" aria-expanded="false">
        <div class="hamburger">
          <span class="hamburger_1"></span>
          <span class="hamburger_2 -translate-x-2"></span>
          <span class="hamburger_3 -translate-x-1"></span>
        </div>
      </button>
    </div>
  </div>
</div>
<div class="sy-page sy-container flex mx-auto">
  <aside id="lside" class="sy-lside md:w-72 md:shrink-0 print:hidden">
    <div class="sy-lside-inner md:sticky">
      <div class="sy-scrollbar p-6"><div class="sidebar-links">
  <ul>
    <li><a class="icon-link" href="https://github.com/MatrixEditor/icspacket/discussions">
  <span class="icon">
    <svg viewBox="0 0 24 24" fill="none">
      <path fill="var(--accent-9)" fill-rule="evenodd" clip-rule="evenodd" d="M11 5a6 6 0 0 0-4.687 9.746c.215.27.315.62.231.954l-.514 2.058a1 1 0 0 0 1.485 1.1l2.848-1.71c.174-.104.374-.15.576-.148H13a6 6 0 0 0 0-12h-2Z"/>
      <circle fill="white" cx="12" cy="11" r="1"/>
      <circle fill="white" cx="9" cy="11" r="1"/>
      <circle fill="white" cx="15" cy="11" r="1"/>
    </svg>
  </span>
  <span class="text">Discussion</span>
</a></li>
  </ul>
</div>
        <div class="globaltoc" data-expand-depth="2"><p class="caption" role="heading" aria-level="3"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/installation.html">Installation</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/protocols.html">Protocols Overview</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../getting-started/coreapi.html">Core API Reference</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">DNP3 / IEEE 1815</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/dnp3read.html">Reading Objects</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/dnp3dump.html">Dumping Objects</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/dnp3resolve.html">Resolve Link Addresses</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/link.html">Link Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/transport.html">Transport Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/application.html">Application Layer</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/master.html">Master</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/dnp3/api/object_library.html">Object Library</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/primitives.html">Primitive Types</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/coding.html">Encoding / Decoding</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/variations.html">Variations</a></li>
<li class="toctree-l3"><a class="reference internal" href="../../../../protocols/dnp3/api/coding_utils.html">Object Utilities</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">IEC 61850</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/iec61850/iedmap.html">Enumerating IEDs</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/iec61850/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/iec61850/api_data_classes.html">Data Classes</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/iec61850/api_path.html">Object / Data References</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/iec61850/api_client.html">IED Client</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">MMS / ISO 9506</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_vars.html">Variable Target Format</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_vars.html#variableaccess-service-rwq">VariableAccess Service (rwq)</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/demo_files.html">FileManagement Service</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/mms/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_conn.html">MMS Connection</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_data.html">Data Conversion</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/mms/api_utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">ACSE / X.227</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/acse/api.html">API Reference</a></li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COPP / X.226 / ISO 8823</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/copp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/copp/presentation.html">ISO Presentation</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/copp/utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COSP / X.225 / ISO 8237-1</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/cosp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/tsdu.html">TSDU</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/spdu.html">SPDU Types</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/values.html">Parameter Values (PV)</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/session.html">ISO Session</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cosp/utils.html">Protocol Utilities</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">COTP / X.224</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/cotp/api.html">API Reference</a><ul>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cotp/structs.html">TPDU Types</a></li>
<li class="toctree-l2 _expand"><a class="reference internal" href="../../../../protocols/cotp/connection.html">Connection</a></li>
</ul>
</li>
</ul>
<p class="caption" role="heading" aria-level="3"><span class="caption-text">TPKT Protocol (RFC1006)</span></p>
<ul>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/tpkt/usage.html">Using a TPKT Wrapper</a></li>
<li class="toctree-l1 _expand"><a class="reference internal" href="../../../../protocols/tpkt/api.html">API Reference</a></li>
</ul>
        </div>
      </div>
    </div>
  </aside>
  <div class="lside-overlay js-menu" role="button" aria-label="Close left sidebar" aria-controls="lside" aria-expanded="false"></div>
  <aside id="rside" class="sy-rside pb-3 w-64 shrink-0 order-last">
    <button class="rside-close js-menu xl:hidden" aria-label="Close Table of Contents" type="button" aria-controls="rside" aria-expanded="false">
      <i class="i-lucide close"></i>
    </button>
    <div class="sy-scrollbar sy-rside-inner px-6 xl:top-16 xl:sticky xl:pl-0 pt-6 pb-4"><a class="js-repo-stats repo-stats flex items-center" href="https://github.com/MatrixEditor/icspacket"
  data-type="github" data-user="MatrixEditor" data-repo="icspacket">
  <span class="w-8 flex items-center justify-around shrink-0 text-3xl">
    <iconify-icon icon="simple-icons:github"></iconify-icon>
  </span>
  <span class="flex-grow px-2 break-all">
    <span style="font-size: small;">MatrixEditor/icspacket</span>
    <span class="flex text-sm repo-stats-count">
      <span class="flex items-center pr-3">
        <iconify-icon icon="lucide:star"></iconify-icon>
        <strong class="js-repo-stars ml-1">0</strong>
      </span>
      <span class="flex items-center">
        <iconify-icon icon="lucide:git-fork"></iconify-icon>
        <strong class="js-repo-forks ml-1">0</strong>
      </span>
    </span>
  </span>
</a></div>
  </aside>
  <div class="rside-overlay js-menu" role="button" aria-label="Close Table of Contents" aria-controls="rside" aria-expanded="false"></div>
  <main class="sy-main w-full max-sm:max-w-full print:pt-6">
<div class="sy-breadcrumbs" role="navigation">
  <div class="sy-breadcrumbs-inner flex items-center">
    <div class="md:hidden mr-3">
      <button class="js-menu" aria-label="Menu" type="button" aria-controls="lside" aria-expanded="false">
        <i class="i-lucide menu"></i>
      </button>
    </div>
    <ol class="flex-1" itemscope itemtype="https://schema.org/BreadcrumbList"><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../../index.html"><span itemprop="name">icspacket</span></a>
        <span>/</span>
        <meta itemprop="position" content="1" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <a itemprop="item" href="../../../index.html"><span itemprop="name">Module code</span></a>
        <span>/</span>
        <meta itemprop="position" content="2" />
      </li><li itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem">
        <strong itemprop="name">icspacket.proto.cotp.structs</strong>
        <meta itemprop="position" content="3" />
      </li></ol>
    <div class="xl:hidden ml-1">
      <button class="js-menu" aria-label="Show table of contents" type="button" aria-controls="rside"
        aria-expanded="false">
        <i class="i-lucide outdent"></i>
      </button>
    </div>
  </div>
</div><div class="flex flex-col break-words justify-between">
      <div class="min-w-0 max-w-6xl px-6 pb-6 pt-8 xl:px-12">
        <article class="yue" role="main">
          <h1>Source code for icspacket.proto.cotp.structs</h1><div class="highlight"><pre>
<span></span><span data-line="1"><span class="c1"># This file is part of icspacket.</span>
</span><span data-line="2"><span class="c1"># Copyright (C) 2025-present  MatrixEditor @ github</span>
</span><span data-line="3"><span class="c1">#</span>
</span><span data-line="4"><span class="c1"># This program is free software: you can redistribute it and/or modify</span>
</span><span data-line="5"><span class="c1"># it under the terms of the GNU General Public License as published by</span>
</span><span data-line="6"><span class="c1"># the Free Software Foundation, either version 3 of the License, or</span>
</span><span data-line="7"><span class="c1"># (at your option) any later version.</span>
</span><span data-line="8"><span class="c1">#</span>
</span><span data-line="9"><span class="c1"># This program is distributed in the hope that it will be useful,</span>
</span><span data-line="10"><span class="c1"># but WITHOUT ANY WARRANTY; without even the implied warranty of</span>
</span><span data-line="11"><span class="c1"># MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span>
</span><span data-line="12"><span class="c1"># GNU General Public License for more details.</span>
</span><span data-line="13"><span class="c1">#</span>
</span><span data-line="14"><span class="c1"># You should have received a copy of the GNU General Public License</span>
</span><span data-line="15"><span class="c1"># along with this program.  If not, see &lt;https://www.gnu.org/licenses/&gt;.</span>
</span><span data-line="16"><span class="c1"># pyright: reportInvalidTypeForm=false, reportGeneralTypeIssues=false, reportAssignmentType=false</span>
</span><span data-line="17">
</span><span data-line="18">
</span><span data-line="19"><span class="c1"># [ITU X.224] - Open Systems Interconnection – Connection-mode protocol</span>
</span><span data-line="20"><span class="c1"># specifications</span>
</span><span data-line="21">
</span><span data-line="22"><span class="kn">from</span><span class="w"> </span><span class="nn">collections.abc</span><span class="w"> </span><span class="kn">import</span> <span class="n">Iterable</span>
</span><span data-line="23"><span class="kn">import</span><span class="w"> </span><span class="nn">enum</span>
</span><span data-line="24">
</span><span data-line="25"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.context</span><span class="w"> </span><span class="kn">import</span> <span class="n">CTX_OBJECT</span>
</span><span data-line="26"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.model</span><span class="w"> </span><span class="kn">import</span> <span class="n">bitfield</span><span class="p">,</span> <span class="n">EnumFactory</span><span class="p">,</span> <span class="n">struct</span>
</span><span data-line="27"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.options</span><span class="w"> </span><span class="kn">import</span> <span class="n">S_ADD_BYTES</span>
</span><span data-line="28"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.shared</span><span class="w"> </span><span class="kn">import</span> <span class="n">Action</span>
</span><span data-line="29"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.shortcuts</span><span class="w"> </span><span class="kn">import</span> <span class="n">F</span><span class="p">,</span> <span class="n">BigEndian</span><span class="p">,</span> <span class="n">opt</span><span class="p">,</span> <span class="n">pack</span><span class="p">,</span> <span class="n">this</span><span class="p">,</span> <span class="n">unpack</span>
</span><span data-line="30"><span class="kn">from</span><span class="w"> </span><span class="nn">caterpillar.fields</span><span class="w"> </span><span class="kn">import</span> <span class="p">(</span>
</span><span data-line="31">    <span class="n">DEFAULT_OPTION</span><span class="p">,</span>
</span><span data-line="32">    <span class="n">Bytes</span><span class="p">,</span>
</span><span data-line="33">    <span class="n">Enum</span><span class="p">,</span>
</span><span data-line="34">    <span class="n">Prefixed</span><span class="p">,</span>
</span><span data-line="35">    <span class="n">uint32</span><span class="p">,</span>
</span><span data-line="36">    <span class="n">uint8</span><span class="p">,</span>
</span><span data-line="37">    <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="38">    <span class="n">ENUM_STRICT</span><span class="p">,</span>
</span><span data-line="39"><span class="p">)</span>
</span><span data-line="40">
</span><span data-line="41">
<div class="viewcode-block" id="checksum">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.checksum">[docs]</a>
</span><span data-line="42"><span class="k">def</span><span class="w"> </span><span class="nf">checksum</span><span class="p">(</span><span class="n">tpdu_data</span><span class="p">:</span> <span class="n">Iterable</span><span class="p">[</span><span class="nb">int</span><span class="p">],</span> <span class="n">checksum_off</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span data-line="43"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="44"><span class="sd">    Compute the checksum for a TPDU according to Annex D.3 of X.224.</span>
</span><span data-line="45">
</span><span data-line="46"><span class="sd">    The algorithm iterates through each octet, maintaining two</span>
</span><span data-line="47"><span class="sd">    accumulators ``C0`` and ``C1``. After processing, the two checksum</span>
</span><span data-line="48"><span class="sd">    octets ``X`` and ``Y`` are computed based on the position of the</span>
</span><span data-line="49"><span class="sd">    checksum parameter and the total TPDU length.</span>
</span><span data-line="50">
</span><span data-line="51"><span class="sd">    **Algorithm (Annex D.3):**</span>
</span><span data-line="52"><span class="sd">      1. Initialize ``C0 = 0`` and ``C1 = 0``.</span>
</span><span data-line="53"><span class="sd">      2. For each octet in the TPDU, add its value to ``C0`` and then</span>
</span><span data-line="54"><span class="sd">         add the new ``C0`` to ``C1``.</span>
</span><span data-line="55"><span class="sd">      3. Compute the checksum values:</span>
</span><span data-line="56"><span class="sd">         - ``X = (-C1 + (L - n) * C0) mod 256``</span>
</span><span data-line="57"><span class="sd">         - ``Y = (C1 - (L - n + 1) * C0) mod 256``</span>
</span><span data-line="58">
</span><span data-line="59"><span class="sd">    :param tpdu_data: Sequence of TPDU octets.</span>
</span><span data-line="60"><span class="sd">    :type tpdu_data: Iterable[int]</span>
</span><span data-line="61"><span class="sd">    :param checksum_off: Offset where the two checksum octets reside.</span>
</span><span data-line="62"><span class="sd">    :type checksum_off: int</span>
</span><span data-line="63"><span class="sd">    :return: Two-byte checksum value (X, Y).</span>
</span><span data-line="64"><span class="sd">    :rtype: bytes</span>
</span><span data-line="65"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="66">
</span><span data-line="67">    <span class="c1"># is the length of the complete TPDU;</span>
</span><span data-line="68">    <span class="n">octets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">tpdu_data</span><span class="p">)</span>
</span><span data-line="69">    <span class="n">L</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span>
</span><span data-line="70">    <span class="n">n</span> <span class="o">=</span> <span class="n">checksum_off</span>
</span><span data-line="71">
</span><span data-line="72">    <span class="c1"># D.3.2 Initialize C0 and C1 to zero.</span>
</span><span data-line="73">    <span class="n">c0</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="74">    <span class="c1"># D.3.3 Process each octet sequentially from i = 1 to L by:</span>
</span><span data-line="75">    <span class="k">for</span> <span class="n">byte</span> <span class="ow">in</span> <span class="n">tpdu_data</span><span class="p">:</span>
</span><span data-line="76">        <span class="c1"># a) adding the value of the octet to C0; then</span>
</span><span data-line="77">        <span class="n">c0</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="o">+</span> <span class="n">byte</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span data-line="78">        <span class="c1"># b) adding the value of C0 to C1.</span>
</span><span data-line="79">        <span class="n">c1</span> <span class="o">=</span> <span class="p">(</span><span class="n">c0</span> <span class="o">+</span> <span class="n">c1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span data-line="80">
</span><span data-line="81">    <span class="c1"># Calculate X and Y</span>
</span><span data-line="82">    <span class="n">x</span> <span class="o">=</span> <span class="p">(</span><span class="o">-</span><span class="n">c1</span> <span class="o">+</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="n">n</span><span class="p">)</span> <span class="o">*</span> <span class="n">c0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span data-line="83">    <span class="n">y</span> <span class="o">=</span> <span class="p">(</span><span class="n">c1</span> <span class="o">-</span> <span class="p">(</span><span class="n">L</span> <span class="o">-</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">c0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="mh">0xFF</span>
</span><span data-line="84">    <span class="k">return</span> <span class="nb">bytes</span><span class="p">([</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">])</span></div>

</span><span data-line="85">
</span><span data-line="86">
<div class="viewcode-block" id="verify_checksum">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.verify_checksum">[docs]</a>
</span><span data-line="87"><span class="k">def</span><span class="w"> </span><span class="nf">verify_checksum</span><span class="p">(</span><span class="n">tpdu_data</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">,</span> <span class="n">checksum_off</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="88"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="89"><span class="sd">    Verify the checksum of a TPDU.</span>
</span><span data-line="90">
</span><span data-line="91"><span class="sd">    The function temporarily zeroes out the checksum field and recomputes</span>
</span><span data-line="92"><span class="sd">    it using :func:`checksum`. If the recomputed checksum matches the</span>
</span><span data-line="93"><span class="sd">    original octets at the checksum offset, the TPDU is considered valid.</span>
</span><span data-line="94">
</span><span data-line="95"><span class="sd">    :param tpdu_data: The TPDU octets containing a checksum field.</span>
</span><span data-line="96"><span class="sd">    :type tpdu_data: bytes</span>
</span><span data-line="97"><span class="sd">    :param checksum_off: Offset to the start of the checksum field.</span>
</span><span data-line="98"><span class="sd">    :type checksum_off: int</span>
</span><span data-line="99"><span class="sd">    :return: ``True`` if checksum matches, ``False`` otherwise.</span>
</span><span data-line="100"><span class="sd">    :rtype: bool</span>
</span><span data-line="101"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="102">    <span class="n">data</span> <span class="o">=</span> <span class="nb">bytearray</span><span class="p">(</span><span class="n">tpdu_data</span><span class="p">)</span>
</span><span data-line="103">    <span class="n">data</span><span class="p">[</span><span class="n">checksum_off</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="104">    <span class="n">data</span><span class="p">[</span><span class="n">checksum_off</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="105">    <span class="k">return</span> <span class="n">checksum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">checksum_off</span><span class="p">)</span> <span class="o">==</span> <span class="n">tpdu_data</span><span class="p">[</span><span class="n">checksum_off</span> <span class="p">:</span> <span class="n">checksum_off</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span></div>

</span><span data-line="106">
</span><span data-line="107">
<div class="viewcode-block" id="TPDU_Code">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Code">[docs]</a>
</span><span data-line="108"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Code</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="109"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.2.2.2 TPDU code&quot;&quot;&quot;</span>
</span><span data-line="110">
</span><span data-line="111">    <span class="n">ED</span> <span class="o">=</span> <span class="mh">0x01</span>  <span class="c1"># Expected Data</span>
</span><span data-line="112">    <span class="n">EA</span> <span class="o">=</span> <span class="mh">0x02</span>  <span class="c1"># Expedited data acknowledgement</span>
</span><span data-line="113">    <span class="n">RJ</span> <span class="o">=</span> <span class="mh">0x03</span>  <span class="c1"># Reject</span>
</span><span data-line="114">    <span class="n">AK</span> <span class="o">=</span> <span class="mh">0x06</span>  <span class="c1"># Data acknowledgement</span>
</span><span data-line="115">    <span class="n">ER</span> <span class="o">=</span> <span class="mh">0x07</span>  <span class="c1"># Error</span>
</span><span data-line="116">    <span class="n">DR</span> <span class="o">=</span> <span class="mh">0x08</span>  <span class="c1"># Disconnect request</span>
</span><span data-line="117">    <span class="n">DC</span> <span class="o">=</span> <span class="mh">0x0C</span>  <span class="c1"># Disconnect confirmation</span>
</span><span data-line="118">    <span class="n">CC</span> <span class="o">=</span> <span class="mh">0x0D</span>  <span class="c1"># Connection confirmation</span>
</span><span data-line="119">    <span class="n">CR</span> <span class="o">=</span> <span class="mh">0x0E</span>  <span class="c1"># Connection request</span>
</span><span data-line="120">    <span class="n">DT</span> <span class="o">=</span> <span class="mh">0x0F</span>  <span class="c1"># Data</span></div>

</span><span data-line="121">
</span><span data-line="122">
<div class="viewcode-block" id="TPDU_Class">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Class">[docs]</a>
</span><span data-line="123"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Class</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="124"><span class="w">    </span><span class="sd">&quot;&quot;&quot;7. Protocol classes&quot;&quot;&quot;</span>
</span><span data-line="125">
</span><span data-line="126">    <span class="n">CLASS0</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="127"><span class="w">    </span><span class="sd">&quot;&quot;&quot;8. Simple class (Class 0)</span>
</span><span data-line="128">
</span><span data-line="129"><span class="sd">    Class 0 provides only the functions needed for connection establishment with</span>
</span><span data-line="130"><span class="sd">    negotiation, data transfer with segmenting and protocol error reporting.</span>
</span><span data-line="131"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="132">
</span><span data-line="133">    <span class="n">CLASS1</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="134"><span class="w">    </span><span class="sd">&quot;&quot;&quot;9. Basic error recovery class (Class 1)</span>
</span><span data-line="135">
</span><span data-line="136"><span class="sd">    Class 1 provides transport connections with flow control based on the</span>
</span><span data-line="137"><span class="sd">    network service provided flow control, error recovery, expedited data</span>
</span><span data-line="138"><span class="sd">    transfer, disconnection, and also the ability to support consecutive</span>
</span><span data-line="139"><span class="sd">    transport connections on a network connection.</span>
</span><span data-line="140"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="141">
</span><span data-line="142">    <span class="n">CLASS2</span> <span class="o">=</span> <span class="mi">2</span>
</span><span data-line="143"><span class="w">    </span><span class="sd">&quot;&quot;&quot;10. Multiplexing class (Class 2)</span>
</span><span data-line="144">
</span><span data-line="145"><span class="sd">    Class 2 provides transport connections with or without individual flow</span>
</span><span data-line="146"><span class="sd">    control; no error detection or error recovery is provided.</span>
</span><span data-line="147"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="148">
</span><span data-line="149">    <span class="n">CLASS3</span> <span class="o">=</span> <span class="mi">3</span>
</span><span data-line="150"><span class="w">    </span><span class="sd">&quot;&quot;&quot;11. Error recovery and multiplexing class</span>
</span><span data-line="151">
</span><span data-line="152"><span class="sd">    Class 3 provides the functionality of class 2 (with use of explicit flow</span>
</span><span data-line="153"><span class="sd">    control) plus the ability to recover after a failure signalled by the</span>
</span><span data-line="154"><span class="sd">    Network Layer without involving the TS-user.</span>
</span><span data-line="155"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="156">
</span><span data-line="157">    <span class="n">CLASS4</span> <span class="o">=</span> <span class="mi">4</span>
</span><span data-line="158"><span class="w">    </span><span class="sd">&quot;&quot;&quot;12. Error detection and recovery class (Class 4)</span>
</span><span data-line="159">
</span><span data-line="160"><span class="sd">    Class 4 provides the functionality of class 3, plus the ability to detect</span>
</span><span data-line="161"><span class="sd">    and recover from lost, duplicated, or out of sequence TPDUs without</span>
</span><span data-line="162"><span class="sd">    involving the TS-user.</span>
</span><span data-line="163"><span class="sd">    &quot;&quot;&quot;</span></div>

</span><span data-line="164">
</span><span data-line="165">
<div class="viewcode-block" id="TPDU_DisconnectReason">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_DisconnectReason">[docs]</a>
</span><span data-line="166"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_DisconnectReason</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="167"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines the reason for disconnecting the transport connection.&quot;&quot;&quot;</span>
</span><span data-line="168">
</span><span data-line="169">    <span class="n">__struct__</span> <span class="o">=</span> <span class="n">uint8</span>
</span><span data-line="170">
</span><span data-line="171">    <span class="n">NORMAL</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">0</span>
</span><span data-line="172"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Normal disconnect initiated by session entity.&quot;&quot;&quot;</span>
</span><span data-line="173">
</span><span data-line="174">    <span class="n">REMOTE_CONGEST</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">1</span>
</span><span data-line="175"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Remote transport entity congestion at connect request time.&quot;&quot;&quot;</span>
</span><span data-line="176">
</span><span data-line="177">    <span class="n">NEGO_FAILED</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">2</span>
</span><span data-line="178"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connection negotiation failed [i.e. proposed class(es) not supported].&quot;&quot;&quot;</span>
</span><span data-line="179">
</span><span data-line="180">    <span class="n">DUPLICATE_SOURCE</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">3</span>
</span><span data-line="181"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Duplicate source reference detected for the same pair of NSAPs.&quot;&quot;&quot;</span>
</span><span data-line="182">
</span><span data-line="183">    <span class="n">MISMATCHED_REFERENCES</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">4</span>
</span><span data-line="184"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Mismatched references.&quot;&quot;&quot;</span>
</span><span data-line="185">
</span><span data-line="186">    <span class="n">PROTOCOL_ERROR</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">5</span>
</span><span data-line="187"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Protocol error.&quot;&quot;&quot;</span>
</span><span data-line="188">
</span><span data-line="189">    <span class="n">REF_OVERFLOW</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">7</span>
</span><span data-line="190"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reference overflow.&quot;&quot;&quot;</span>
</span><span data-line="191">
</span><span data-line="192">    <span class="n">CONN_REFUSED</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">8</span>
</span><span data-line="193"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Connection request refused on this network connection.&quot;&quot;&quot;</span>
</span><span data-line="194">
</span><span data-line="195">    <span class="n">INVALID_LENGTH</span> <span class="o">=</span> <span class="mi">128</span> <span class="o">+</span> <span class="mi">10</span>
</span><span data-line="196"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Header or parameter length invalid.&quot;&quot;&quot;</span>
</span><span data-line="197">
</span><span data-line="198">    <span class="c1"># available for all classes</span>
</span><span data-line="199">    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="200"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reason not specified.&quot;&quot;&quot;</span>
</span><span data-line="201">
</span><span data-line="202">    <span class="n">TSAP_CONGESTION</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="203"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Congestion at TSAP.&quot;&quot;&quot;</span>
</span><span data-line="204">
</span><span data-line="205">    <span class="n">ENTITIY_NOT_ATTACHED</span> <span class="o">=</span> <span class="mi">2</span>
</span><span data-line="206"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Session entity not attached to TSAP.&quot;&quot;&quot;</span>
</span><span data-line="207">
</span><span data-line="208">    <span class="n">UNKNOWN_ADDRESS</span> <span class="o">=</span> <span class="mi">3</span>
</span><span data-line="209"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Address unknown.&quot;&quot;&quot;</span></div>

</span><span data-line="210">
</span><span data-line="211">
<div class="viewcode-block" id="TPDU_Size">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Size">[docs]</a>
</span><span data-line="212"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Size</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="213"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="214"><span class="sd">    Defines the proposed maximum TPDU size (in octets including the header) to</span>
</span><span data-line="215"><span class="sd">    be used over the requested transport connection</span>
</span><span data-line="216"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="217">
</span><span data-line="218">    <span class="c1"># fmt: off</span>
</span><span data-line="219">    <span class="n">SIZE_8192</span> <span class="o">=</span> <span class="mb">0b00001101</span>  <span class="c1"># 8192 octets (not allowed in class 0)</span>
</span><span data-line="220">    <span class="n">SIZE_4096</span> <span class="o">=</span> <span class="mb">0b00001100</span>  <span class="c1"># 4096 octets</span>
</span><span data-line="221">    <span class="n">SIZE_2048</span> <span class="o">=</span> <span class="mb">0b00001011</span>  <span class="c1"># 2048 octets</span>
</span><span data-line="222">    <span class="n">SIZE_1024</span> <span class="o">=</span> <span class="mb">0b00001010</span>  <span class="c1"># 1024 octets</span>
</span><span data-line="223">    <span class="n">SIZE_512</span>  <span class="o">=</span> <span class="mb">0b00001001</span>  <span class="c1"># 512 octets</span>
</span><span data-line="224">    <span class="n">SIZE_256</span>  <span class="o">=</span> <span class="mb">0b00001000</span>  <span class="c1"># 256 octets</span>
</span><span data-line="225">    <span class="n">SIZE_128</span>  <span class="o">=</span> <span class="mb">0b00000111</span>  <span class="c1"># 128 octets</span></div>

</span><span data-line="226">    <span class="c1"># fmt: on</span>
</span><span data-line="227">
</span><span data-line="228">
<div class="viewcode-block" id="TPDU_RejectCause">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_RejectCause">[docs]</a>
</span><span data-line="229"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_RejectCause</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="230"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cause of rejection of a connection request&quot;&quot;&quot;</span>
</span><span data-line="231">
</span><span data-line="232">    <span class="n">__struct__</span> <span class="o">=</span> <span class="n">uint8</span>
</span><span data-line="233">
</span><span data-line="234">    <span class="n">UNSPECIFIED</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="235"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Cause not specified&quot;&quot;&quot;</span>
</span><span data-line="236">
</span><span data-line="237">    <span class="n">INVALID_PARAMETER_CODE</span> <span class="o">=</span> <span class="mi">1</span>
</span><span data-line="238"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalid parameter code&quot;&quot;&quot;</span>
</span><span data-line="239">
</span><span data-line="240">    <span class="n">INVALID_PDU_TYPE</span> <span class="o">=</span> <span class="mi">2</span>
</span><span data-line="241"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalid PDU type&quot;&quot;&quot;</span>
</span><span data-line="242">
</span><span data-line="243">    <span class="n">INVALID_PARAMETER_VALUE</span> <span class="o">=</span> <span class="mi">3</span>
</span><span data-line="244"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Invalid parameter value&quot;&quot;&quot;</span></div>

</span><span data-line="245">
</span><span data-line="246">
<div class="viewcode-block" id="TPDU_AdditionalOptions">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_AdditionalOptions">[docs]</a>
</span><span data-line="247"><span class="nd">@bitfield</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">opt</span><span class="o">.</span><span class="n">S_ADD_BYTES</span><span class="p">])</span>
</span><span data-line="248"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_AdditionalOptions</span><span class="p">:</span>
</span><span data-line="249"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Additional option selection (not used if class 0 is the preferred</span>
</span><span data-line="250"><span class="sd">    class)&quot;&quot;&quot;</span>
</span><span data-line="251">
</span><span data-line="252">    <span class="c1"># fmt: off</span>
</span><span data-line="253">    <span class="n">unused</span>                 <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="254">    <span class="n">non_blocking</span>           <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="255"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use of non-blocking expedited data in class 4&quot;&quot;&quot;</span>
</span><span data-line="256">
</span><span data-line="257">    <span class="n">use_request_ack</span>        <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="258"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use of request acknowledgement in class 1, 3, 4&quot;&quot;&quot;</span>
</span><span data-line="259">
</span><span data-line="260">    <span class="n">use_selective_ack</span>      <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="261"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use of selective acknowledgement in class 4&quot;&quot;&quot;</span>
</span><span data-line="262">
</span><span data-line="263">    <span class="n">speed_up</span>               <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="264"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use of network expedited in class 1&quot;&quot;&quot;</span>
</span><span data-line="265">
</span><span data-line="266">    <span class="n">use_receipt_info</span>       <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="267"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="268"><span class="sd">    - True: Use of receipt confirmation in class 1</span>
</span><span data-line="269"><span class="sd">    - False: Use of explicit AK variant in class 1</span>
</span><span data-line="270"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="271">
</span><span data-line="272">    <span class="n">use_checksum_16bit</span>     <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="273"><span class="w">    </span><span class="sd">&quot;&quot;&quot;16-bit checksum defined in 6.17 shall be used in class 4&quot;&quot;&quot;</span>
</span><span data-line="274">
</span><span data-line="275">    <span class="n">use_transport_speed_up</span> <span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">True</span>
</span><span data-line="276"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Use of transport expedited data transfer service&quot;&quot;&quot;</span></div>

</span><span data-line="277">    <span class="c1"># fmt: on</span>
</span><span data-line="278">
</span><span data-line="279">
<div class="viewcode-block" id="TPDU_TransitDelay">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_TransitDelay">[docs]</a>
</span><span data-line="280"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">S_ADD_BYTES</span><span class="p">])</span>
</span><span data-line="281"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_TransitDelay</span><span class="p">:</span>
</span><span data-line="282"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transit delay (not used if class 0 is the preferred class)&quot;&quot;&quot;</span>
</span><span data-line="283">
</span><span data-line="284">    <span class="c1"># fmt: off</span>
</span><span data-line="285">    <span class="n">calling_target_value</span>        <span class="p">:</span> <span class="n">uint16</span>    <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="286"><span class="w">    </span><span class="sd">&quot;&quot;&quot;target value, calling-called user direction;&quot;&quot;&quot;</span>
</span><span data-line="287">
</span><span data-line="288">    <span class="n">calling_maximum_acceptable</span>  <span class="p">:</span> <span class="n">uint16</span>    <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="289"><span class="w">    </span><span class="sd">&quot;&quot;&quot;maximum acceptable, calling-called user direction;&quot;&quot;&quot;</span>
</span><span data-line="290">
</span><span data-line="291">    <span class="n">called_target_value</span>         <span class="p">:</span> <span class="n">uint16</span>    <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="292"><span class="w">    </span><span class="sd">&quot;&quot;&quot;target value, called-calling user direction;&quot;&quot;&quot;</span>
</span><span data-line="293">
</span><span data-line="294">    <span class="n">called_maximum_acceptable</span>   <span class="p">:</span> <span class="n">uint16</span>    <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="295"><span class="w">    </span><span class="sd">&quot;&quot;&quot;maximum acceptable, called-calling user direction;&quot;&quot;&quot;</span></div>

</span><span data-line="296">    <span class="c1"># fmt: on</span>
</span><span data-line="297">
</span><span data-line="298">
<div class="viewcode-block" id="TPDU_ResidualErrorRate">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ResidualErrorRate">[docs]</a>
</span><span data-line="299"><span class="nd">@struct</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">S_ADD_BYTES</span><span class="p">])</span>
</span><span data-line="300"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ResidualErrorRate</span><span class="p">:</span>
</span><span data-line="301"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Residual error rate (not used if class 0 is the preferred class)&quot;&quot;&quot;</span>
</span><span data-line="302">
</span><span data-line="303">    <span class="c1"># fmt: off</span>
</span><span data-line="304">    <span class="n">target_value</span>          <span class="p">:</span> <span class="n">uint8</span>   <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="305"><span class="w">    </span><span class="sd">&quot;&quot;&quot;target value, power of 10;&quot;&quot;&quot;</span>
</span><span data-line="306">
</span><span data-line="307">    <span class="n">minimum_acceptable</span>    <span class="p">:</span> <span class="n">uint8</span>   <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="308"><span class="w">    </span><span class="sd">&quot;&quot;&quot;minimum acceptable, power of 10;&quot;&quot;&quot;</span>
</span><span data-line="309">
</span><span data-line="310">    <span class="n">tsdu_size_of_interest</span> <span class="p">:</span> <span class="n">uint8</span>   <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="311"><span class="w">    </span><span class="sd">&quot;&quot;&quot;TSDU size of interest, expressed as a power of 2.&quot;&quot;&quot;</span></div>

</span><span data-line="312">    <span class="c1"># fmt: on</span>
</span><span data-line="313">
</span><span data-line="314">
</span><span data-line="315"><span class="n">TPDU_Checksum</span> <span class="o">=</span> <span class="n">Bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</span><span data-line="316">
</span><span data-line="317">
<div class="viewcode-block" id="Parameter_Code">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.Parameter_Code">[docs]</a>
</span><span data-line="318"><span class="k">class</span><span class="w"> </span><span class="nc">Parameter_Code</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="319"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Defines different parameter types used accross TPDUs&quot;&quot;&quot;</span>
</span><span data-line="320">
</span><span data-line="321">    <span class="n">__struct__</span> <span class="o">=</span> <span class="n">uint8</span>
</span><span data-line="322">
</span><span data-line="323">    <span class="c1"># fmt: off</span>
</span><span data-line="324">    <span class="n">CALLED_T_SELECTOR</span>   <span class="o">=</span> <span class="mb">0b11000001</span>  <span class="c1"># Transport-Selector (T-selector) called or Invalid TPDU</span>
</span><span data-line="325">    <span class="n">CALLING_T_SELECTOR</span>  <span class="o">=</span> <span class="mb">0b11000010</span>  <span class="c1"># Transport-Selector (T-selector) calling</span>
</span><span data-line="326">    <span class="n">TPDU_SIZE</span>           <span class="o">=</span> <span class="mb">0b11000000</span>  <span class="c1"># TPDU size</span>
</span><span data-line="327">    <span class="n">MAX_TPDU_SIZE</span>       <span class="o">=</span> <span class="mb">0b11110000</span>  <span class="c1"># Preferred maximum TPDU size</span>
</span><span data-line="328">    <span class="n">VERSION</span>             <span class="o">=</span> <span class="mb">0b11000100</span>  <span class="c1"># Version number</span>
</span><span data-line="329">    <span class="n">PROTECTION</span>          <span class="o">=</span> <span class="mb">0b11000101</span>  <span class="c1"># Protection parameters</span>
</span><span data-line="330">    <span class="n">CHECKSUM</span>            <span class="o">=</span> <span class="mb">0b11000011</span>  <span class="c1"># Checksum</span>
</span><span data-line="331">    <span class="n">ADDITIONAL_OPTS</span>     <span class="o">=</span> <span class="mb">0b11000110</span>  <span class="c1"># Additional option selection</span>
</span><span data-line="332">    <span class="n">ALTERNATIVE_CLASSES</span> <span class="o">=</span> <span class="mb">0b11000111</span>  <span class="c1"># Alternative protocol classes</span>
</span><span data-line="333">    <span class="n">ACK_TIME</span>            <span class="o">=</span> <span class="mb">0b10000101</span>  <span class="c1"># Acknowledgement time</span>
</span><span data-line="334">    <span class="n">THROUGHPUT</span>          <span class="o">=</span> <span class="mb">0b10001001</span>  <span class="c1"># Throughput indication</span>
</span><span data-line="335">    <span class="n">ERROR_RATE</span>          <span class="o">=</span> <span class="mb">0b10000110</span>  <span class="c1"># Residual error rate</span>
</span><span data-line="336">    <span class="n">PRIORITY</span>            <span class="o">=</span> <span class="mb">0b10000111</span>  <span class="c1"># Priority</span>
</span><span data-line="337">    <span class="n">TRANSIT_DELAY</span>       <span class="o">=</span> <span class="mb">0b10001000</span>  <span class="c1"># Transit delay</span>
</span><span data-line="338">    <span class="n">REASSIGNMENT_TIME</span>   <span class="o">=</span> <span class="mb">0b10001011</span>  <span class="c1"># Reassignment time</span>
</span><span data-line="339">    <span class="n">INACTIVITY</span>          <span class="o">=</span> <span class="mb">0b11110010</span>  <span class="c1"># Inactivity timer</span>
</span><span data-line="340">    <span class="n">ADDTITIONAL_INFO</span>    <span class="o">=</span> <span class="mb">0b11100000</span>  <span class="c1"># DR additional information</span>
</span><span data-line="341">    <span class="n">SUBSEQUENCE_NUM</span>     <span class="o">=</span> <span class="mb">0b10001010</span>  <span class="c1"># Subsequence number</span>
</span><span data-line="342">    <span class="n">FLOW_CONTROL_INFO</span>   <span class="o">=</span> <span class="mb">0b10001100</span>  <span class="c1"># Flow control information</span>
</span><span data-line="343">    <span class="n">ACK_PARAMS</span>          <span class="o">=</span> <span class="mb">0b10001111</span>  <span class="c1"># Selective acknowledgement parameters</span></div>

</span><span data-line="344">    <span class="c1"># fmt: on</span>
</span><span data-line="345">
</span><span data-line="346">
</span><span data-line="347"><span class="c1"># fmt: off</span>
</span><span data-line="348"><span class="n">TPDU_PARAM_TYPES</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="349">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">TPDU_SIZE</span>           <span class="p">:</span> <span class="n">Enum</span><span class="p">(</span><span class="n">TPDU_Size</span><span class="p">,</span> <span class="n">uint8</span><span class="p">),</span>
</span><span data-line="350">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">VERSION</span>             <span class="p">:</span> <span class="n">uint8</span><span class="p">,</span>
</span><span data-line="351">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span>            <span class="p">:</span> <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="352">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">ADDITIONAL_OPTS</span>     <span class="p">:</span> <span class="n">TPDU_AdditionalOptions</span><span class="p">,</span>
</span><span data-line="353">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">ALTERNATIVE_CLASSES</span> <span class="p">:</span> <span class="n">uint8</span><span class="p">[</span><span class="o">...</span><span class="p">],</span>
</span><span data-line="354">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">ACK_TIME</span>            <span class="p">:</span> <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="355">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">ERROR_RATE</span>          <span class="p">:</span> <span class="n">TPDU_ResidualErrorRate</span><span class="p">,</span>
</span><span data-line="356">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">PRIORITY</span>            <span class="p">:</span> <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="357">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">TRANSIT_DELAY</span>       <span class="p">:</span> <span class="n">TPDU_TransitDelay</span><span class="p">,</span>
</span><span data-line="358">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">REASSIGNMENT_TIME</span>   <span class="p">:</span> <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="359">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">INACTIVITY</span>          <span class="p">:</span> <span class="n">uint32</span><span class="p">,</span>
</span><span data-line="360">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">SUBSEQUENCE_NUM</span>     <span class="p">:</span> <span class="n">uint16</span><span class="p">,</span>
</span><span data-line="361">    <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span>            <span class="p">:</span> <span class="n">TPDU_Checksum</span><span class="p">,</span>
</span><span data-line="362">    <span class="c1"># Parameter_Code.CALLED_T_SELECTOR   : uint16,</span>
</span><span data-line="363">    <span class="c1"># Parameter_Code.CALLING_T_SELECTOR  : uint16,</span>
</span><span data-line="364">
</span><span data-line="365">    <span class="c1"># all other options will use raw bytes</span>
</span><span data-line="366">    <span class="n">DEFAULT_OPTION</span>                     <span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="o">...</span><span class="p">),</span>
</span><span data-line="367"><span class="p">}</span>
</span><span data-line="368"><span class="c1"># fmt: on</span>
</span><span data-line="369">
</span><span data-line="370">
<div class="viewcode-block" id="Parameter">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.Parameter">[docs]</a>
</span><span data-line="371"><span class="nd">@struct</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">S_ADD_BYTES</span><span class="p">])</span>
</span><span data-line="372"><span class="k">class</span><span class="w"> </span><span class="nc">Parameter</span><span class="p">:</span>
</span><span data-line="373"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.2.3 Variable part</span>
</span><span data-line="374">
</span><span data-line="375"><span class="sd">    The variable part is used to define less frequently used parameters. If the</span>
</span><span data-line="376"><span class="sd">    variable part is present, it shall contain one or more parameters.</span>
</span><span data-line="377"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="378">
</span><span data-line="379">    <span class="c1"># fmt: off</span>
</span><span data-line="380">    <span class="n">type_id</span> <span class="p">:</span> <span class="n">Enum</span><span class="p">(</span><span class="n">Parameter_Code</span><span class="p">,</span> <span class="n">uint8</span><span class="p">)</span> <span class="o">|</span> <span class="n">ENUM_STRICT</span>                           <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="381"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The parameter code&quot;&quot;&quot;</span>
</span><span data-line="382">
</span><span data-line="383">    <span class="c1"># Simple TLV structure with dynamic parsing behabior</span>
</span><span data-line="384">    <span class="n">value</span>   <span class="p">:</span> <span class="n">Prefixed</span><span class="p">(</span><span class="n">uint8</span><span class="p">,</span> <span class="n">F</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">type_id</span><span class="p">)</span> <span class="o">&gt;&gt;</span> <span class="n">TPDU_PARAM_TYPES</span><span class="p">)</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="385"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="386"><span class="sd">    The parameter length indication indicates the length, in octets, of the</span>
</span><span data-line="387"><span class="sd">    parameter value field.</span>
</span><span data-line="388">
</span><span data-line="389"><span class="sd">    The parameter value field contains the value of the parameter identified in</span>
</span><span data-line="390"><span class="sd">    the parameter code field.</span>
</span><span data-line="391"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="392">
</span><span data-line="393">    <span class="c1"># --- Verification</span>
</span><span data-line="394">    <span class="nd">@staticmethod</span>
</span><span data-line="395">    <span class="k">def</span><span class="w"> </span><span class="nf">_verify_parameter</span><span class="p">(</span><span class="n">context</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="396">        <span class="c1"># Since we&#39;re using a greedy length by default on the value, we can&#39;t be</span>
</span><span data-line="397">        <span class="c1"># sure if the parameter is valid or not. This action resolbes that</span>
</span><span data-line="398">        <span class="c1"># issue.</span>
</span><span data-line="399">        <span class="n">parameter</span> <span class="o">=</span> <span class="n">context</span><span class="p">[</span><span class="n">CTX_OBJECT</span><span class="p">]</span>
</span><span data-line="400">        <span class="k">if</span> <span class="n">parameter</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">parameter</span><span class="o">.</span><span class="n">value</span><span class="p">:</span>
</span><span data-line="401">            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid parameter&quot;</span><span class="p">)</span>
</span><span data-line="402">
</span><span data-line="403">    <span class="n">_verify</span><span class="p">:</span> <span class="n">Action</span><span class="p">(</span><span class="n">unpack</span><span class="o">=</span><span class="n">_verify_parameter</span><span class="p">)</span></div>

</span><span data-line="404">    <span class="c1"># fmt: on</span>
</span><span data-line="405">
</span><span data-line="406">
<div class="viewcode-block" id="TPDU">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU">[docs]</a>
</span><span data-line="407"><span class="nd">@struct</span>
</span><span data-line="408"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU</span><span class="p">:</span>
</span><span data-line="409"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Transport Protocol Data Units (TPDUs)&quot;&quot;&quot;</span>
</span><span data-line="410">
</span><span data-line="411">    <span class="c1"># fmt: off</span>
</span><span data-line="412">
</span><span data-line="413">    <span class="n">li</span>   <span class="p">:</span> <span class="n">uint8</span>     <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="414"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.2.1 Length indicator field</span>
</span><span data-line="415">
</span><span data-line="416"><span class="sd">    The length indicated shall be the header length in octets including</span>
</span><span data-line="417"><span class="sd">    parameters, but excluding the length indicator field and user data, if any.</span>
</span><span data-line="418"><span class="sd">    The value 255 (1111 1111) is reserved for possible extensions.</span>
</span><span data-line="419"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="420">
</span><span data-line="421">    <span class="n">code</span> <span class="p">:</span> <span class="n">uint8</span>     <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="422"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.2.2.2 TPDU code</span>
</span><span data-line="423">
</span><span data-line="424"><span class="sd">    This field contains the TPDU code. It is used to define the structure of the</span>
</span><span data-line="425"><span class="sd">    remaining header.</span>
</span><span data-line="426"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="427">    <span class="c1"># fmt: on</span>
</span><span data-line="428">
</span><span data-line="429">    <span class="nd">@property</span>
</span><span data-line="430">    <span class="k">def</span><span class="w"> </span><span class="nf">tpdu_code</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TPDU_Code</span><span class="p">:</span>
</span><span data-line="431"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Qualified TPDU code&quot;&quot;&quot;</span>
</span><span data-line="432">        <span class="k">return</span> <span class="n">TPDU_Code</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&gt;&gt;</span> <span class="mi">4</span><span class="p">)</span>
</span><span data-line="433">
</span><span data-line="434">    <span class="nd">@tpdu_code</span><span class="o">.</span><span class="n">setter</span>
</span><span data-line="435">    <span class="k">def</span><span class="w"> </span><span class="nf">tpdu_code</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="n">TPDU_Code</span><span class="p">):</span>
</span><span data-line="436">        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x0F</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">value</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;&lt;</span> <span class="mi">4</span><span class="p">)</span>
</span><span data-line="437">
</span><span data-line="438">    <span class="nd">@property</span>
</span><span data-line="439">    <span class="k">def</span><span class="w"> </span><span class="nf">code_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="440"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Argument bits of the TPDU code&quot;&quot;&quot;</span>
</span><span data-line="441">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0x0F</span>
</span><span data-line="442">
</span><span data-line="443">    <span class="nd">@code_arg</span><span class="o">.</span><span class="n">setter</span>
</span><span data-line="444">    <span class="k">def</span><span class="w"> </span><span class="nf">code_arg</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
</span><span data-line="445">        <span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">=</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">code</span> <span class="o">&amp;</span> <span class="mh">0xF0</span><span class="p">)</span> <span class="o">|</span> <span class="n">value</span>
</span><span data-line="446">
<div class="viewcode-block" id="TPDU.has_parameters">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.has_parameters">[docs]</a>
</span><span data-line="447">    <span class="k">def</span><span class="w"> </span><span class="nf">has_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="448"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Whether the TPDU has parameters&quot;&quot;&quot;</span>
</span><span data-line="449">        <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">))</span></div>

</span><span data-line="450">
<div class="viewcode-block" id="TPDU.get_parameters">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.get_parameters">[docs]</a>
</span><span data-line="451">    <span class="k">def</span><span class="w"> </span><span class="nf">get_parameters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Parameter</span><span class="p">]:</span>
</span><span data-line="452"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the parameters of the TPDU if present&quot;&quot;&quot;</span>
</span><span data-line="453">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;parameters&quot;</span><span class="p">,</span> <span class="p">[])</span></div>

</span><span data-line="454">
<div class="viewcode-block" id="TPDU.has_checksum">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.has_checksum">[docs]</a>
</span><span data-line="455">    <span class="k">def</span><span class="w"> </span><span class="nf">has_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="456"><span class="w">        </span><span class="sd">&quot;&quot;&quot;Checks whether the TPDU has a checksum parameter&quot;&quot;&quot;</span>
</span><span data-line="457">        <span class="k">return</span> <span class="nb">any</span><span class="p">(</span>
</span><span data-line="458">            <span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()))</span>
</span><span data-line="459">        <span class="p">)</span></div>

</span><span data-line="460">
</span><span data-line="461">    <span class="nd">@property</span>
</span><span data-line="462">    <span class="k">def</span><span class="w"> </span><span class="nf">fixed_size</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="463"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="464"><span class="sd">        Returns the number of octets that make up the fixed (header) part</span>
</span><span data-line="465"><span class="sd">        of this TPDU, excluding the variable part and user data.</span>
</span><span data-line="466">
</span><span data-line="467"><span class="sd">        This value is normally defined per TPDU type in X.224 and stored</span>
</span><span data-line="468"><span class="sd">        as the class attribute ``TPDU_FIXED_SIZE``. If the subclass does</span>
</span><span data-line="469"><span class="sd">        not define it, a default of 1 octet is returned.</span>
</span><span data-line="470">
</span><span data-line="471"><span class="sd">        The fixed size is used when computing the length indicator (LI),</span>
</span><span data-line="472"><span class="sd">        and also when locating parameter offsets, such as the position</span>
</span><span data-line="473"><span class="sd">        of the checksum parameter.</span>
</span><span data-line="474"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="475">        <span class="k">return</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;TPDU_FIXED_SIZE&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span data-line="476">
</span><span data-line="477">    <span class="nd">@property</span>
</span><span data-line="478">    <span class="k">def</span><span class="w"> </span><span class="nf">first_checksum_octet</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="479"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="480"><span class="sd">        Returns the zero-based index (offset) of the first checksum octet</span>
</span><span data-line="481"><span class="sd">        within the serialized TPDU, or -1 if no parameters are present.</span>
</span><span data-line="482">
</span><span data-line="483"><span class="sd">        For ease of computation, the checksum parameter MUST appear in</span>
</span><span data-line="484"><span class="sd">        the *first position* of the variable part when present. This means:</span>
</span><span data-line="485">
</span><span data-line="486"><span class="sd">        - Offset starts at ``fixed_size`` (end of fixed header)</span>
</span><span data-line="487"><span class="sd">        - Add 1 byte for the Length Indicator (LI)</span>
</span><span data-line="488"><span class="sd">        - Add 2 bytes for the TLV header (parameter code and length)</span>
</span><span data-line="489"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="490">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_parameters</span><span class="p">():</span>
</span><span data-line="491">            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>
</span><span data-line="492">
</span><span data-line="493">        <span class="c1"># checksum MUST be in the first position of the parameters.</span>
</span><span data-line="494">        <span class="c1"># Add one for the length indicator</span>
</span><span data-line="495">        <span class="c1"># Add two for the TLV header (type_id, length)</span>
</span><span data-line="496">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_size</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">2</span>
</span><span data-line="497">
<div class="viewcode-block" id="TPDU.get_checksum">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.get_checksum">[docs]</a>
</span><span data-line="498">    <span class="k">def</span><span class="w"> </span><span class="nf">get_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span data-line="499"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="500"><span class="sd">        Returns the current 2-byte checksum value from the variable part,</span>
</span><span data-line="501"><span class="sd">        if a checksum parameter is present. If no checksum parameter is</span>
</span><span data-line="502"><span class="sd">        found, returns an empty byte string.</span>
</span><span data-line="503">
</span><span data-line="504"><span class="sd">        The checksum parameter is identified by its type code</span>
</span><span data-line="505"><span class="sd">        ``Parameter_Code.CHECKSUM`` and should be the first parameter.</span>
</span><span data-line="506"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="507">        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
</span><span data-line="508">        <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">parameters</span><span class="p">:</span>
</span><span data-line="509">            <span class="k">if</span> <span class="n">p</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span><span class="p">:</span>
</span><span data-line="510">                <span class="k">return</span> <span class="n">p</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="511">        <span class="k">return</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span></div>

</span><span data-line="512">
<div class="viewcode-block" id="TPDU.set_checksum">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.set_checksum">[docs]</a>
</span><span data-line="513">    <span class="k">def</span><span class="w"> </span><span class="nf">set_checksum</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span data-line="514"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="515"><span class="sd">        Sets the checksum parameter value in the TPDU.</span>
</span><span data-line="516">
</span><span data-line="517"><span class="sd">        If a checksum parameter already exists, its value is replaced.</span>
</span><span data-line="518"><span class="sd">        If it does not exist, it is inserted into the first position</span>
</span><span data-line="519"><span class="sd">        of the parameter list. This ensures the checksum field is correctly</span>
</span><span data-line="520"><span class="sd">        located for both building and verification.</span>
</span><span data-line="521"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="522">        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
</span><span data-line="523">        <span class="n">parameter</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span>
</span><span data-line="524">            <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">type_id</span> <span class="o">==</span> <span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span><span class="p">,</span> <span class="n">parameters</span><span class="p">),</span> <span class="kc">None</span>
</span><span data-line="525">        <span class="p">)</span>
</span><span data-line="526">        <span class="k">if</span> <span class="n">parameter</span><span class="p">:</span>
</span><span data-line="527">            <span class="n">parameter</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>
</span><span data-line="528">        <span class="k">else</span><span class="p">:</span>
</span><span data-line="529">            <span class="c1"># always first position</span>
</span><span data-line="530">            <span class="n">parameters</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">Parameter</span><span class="p">(</span><span class="n">Parameter_Code</span><span class="o">.</span><span class="n">CHECKSUM</span><span class="p">,</span> <span class="n">value</span><span class="p">))</span></div>

</span><span data-line="531">
<div class="viewcode-block" id="TPDU.is_valid">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.is_valid">[docs]</a>
</span><span data-line="532">    <span class="k">def</span><span class="w"> </span><span class="nf">is_valid</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="533"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="534"><span class="sd">        Verifies the TPDU checksum if present.</span>
</span><span data-line="535">
</span><span data-line="536"><span class="sd">        - If no checksum parameter is found, returns True (valid by default).</span>
</span><span data-line="537"><span class="sd">        - If present, recomputes the checksum over the TPDU using the</span>
</span><span data-line="538"><span class="sd">          Annex D.3 algorithm, comparing the calculated value to the</span>
</span><span data-line="539"><span class="sd">          stored one.</span>
</span><span data-line="540">
</span><span data-line="541"><span class="sd">        This method does not rebuild the TPDU using ``build()`` to avoid</span>
</span><span data-line="542"><span class="sd">        unintentional mutations; it uses the raw packed representation</span>
</span><span data-line="543"><span class="sd">        for verification.</span>
</span><span data-line="544"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="545">        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">has_checksum</span><span class="p">():</span>
</span><span data-line="546">            <span class="k">return</span> <span class="kc">True</span>
</span><span data-line="547">        <span class="k">return</span> <span class="n">verify_checksum</span><span class="p">(</span><span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">),</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_checksum_octet</span><span class="p">)</span></div>

</span><span data-line="548">
<div class="viewcode-block" id="TPDU.build">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.build">[docs]</a>
</span><span data-line="549">    <span class="k">def</span><span class="w"> </span><span class="nf">build</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">add_checksum</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bytes</span><span class="p">:</span>
</span><span data-line="550"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="551"><span class="sd">        Serializes the TPDU into its octet representation.</span>
</span><span data-line="552">
</span><span data-line="553"><span class="sd">        This method constructs a valid TPDU by encoding its fixed and</span>
</span><span data-line="554"><span class="sd">        variable parts, and optionally adds a checksum parameter.</span>
</span><span data-line="555">
</span><span data-line="556"><span class="sd">        Behavior depends on ``add_checksum``:</span>
</span><span data-line="557">
</span><span data-line="558"><span class="sd">        - **False (default)**: The TPDU is serialized normally without</span>
</span><span data-line="559"><span class="sd">          any checksum.</span>
</span><span data-line="560"><span class="sd">        - **True**:</span>
</span><span data-line="561"><span class="sd">            1. A placeholder checksum parameter (two zero bytes) is</span>
</span><span data-line="562"><span class="sd">               inserted.</span>
</span><span data-line="563"><span class="sd">            2. The TPDU is packed into octets.</span>
</span><span data-line="564"><span class="sd">            3. The checksum is recomputed across the entire TPDU (with</span>
</span><span data-line="565"><span class="sd">               zeros in the checksum field).</span>
</span><span data-line="566"><span class="sd">            4. The placeholder checksum is replaced with the computed</span>
</span><span data-line="567"><span class="sd">               value and the TPDU is repacked.</span>
</span><span data-line="568">
</span><span data-line="569"><span class="sd">        Example:</span>
</span><span data-line="570">
</span><span data-line="571"><span class="sd">        &gt;&gt;&gt; pdu = TPDU_ConnectionRequest()</span>
</span><span data-line="572"><span class="sd">        &gt;&gt;&gt; pdu.build(add_checksum=True)</span>
</span><span data-line="573"><span class="sd">        b&#39;\\n\\xe0\\x00\\x00\\x00\\x00\\x00\\xc3\\x02|\\xd5&#39;</span>
</span><span data-line="574"><span class="sd">        &gt;&gt;&gt; parsed = TPDU_ConnectionRequest.from_octets(_)</span>
</span><span data-line="575"><span class="sd">        TPDU_ConnectionRequest(li=10, code=224,...parameters=[Parameter(type_id=&lt;Parameter_Code.CHECKSUM: 195&gt;, value=b&#39;|\\xd5&#39;)])</span>
</span><span data-line="576">
</span><span data-line="577"><span class="sd">        :param add_checksum: Whether to generate and insert a checksum</span>
</span><span data-line="578"><span class="sd">                             parameter during the build process.</span>
</span><span data-line="579"><span class="sd">        :return: Byte string representing the complete TPDU.</span>
</span><span data-line="580"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="581">        <span class="n">fixed_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fixed_size</span>
</span><span data-line="582">        <span class="c1"># D.3.1 Set up the complete TPDU with the value of the checksum</span>
</span><span data-line="583">        <span class="c1"># parameter field set to zero.</span>
</span><span data-line="584">        <span class="k">if</span> <span class="n">add_checksum</span><span class="p">:</span>
</span><span data-line="585">            <span class="bp">self</span><span class="o">.</span><span class="n">set_checksum</span><span class="p">(</span><span class="nb">bytes</span><span class="p">(</span><span class="mi">2</span><span class="p">))</span>
</span><span data-line="586">
</span><span data-line="587">        <span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_parameters</span><span class="p">()</span>
</span><span data-line="588">        <span class="n">variable_part</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="n">parameters</span><span class="p">,</span> <span class="n">TPDU_VariablePart</span><span class="p">)</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span> <span class="k">else</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="589">        <span class="bp">self</span><span class="o">.</span><span class="n">li</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">variable_part</span><span class="p">)</span> <span class="o">+</span> <span class="n">fixed_size</span>
</span><span data-line="590">        <span class="n">tpdu_data</span> <span class="o">=</span> <span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="591">        <span class="k">if</span> <span class="n">add_checksum</span><span class="p">:</span>
</span><span data-line="592">            <span class="bp">self</span><span class="o">.</span><span class="n">set_checksum</span><span class="p">(</span><span class="n">checksum</span><span class="p">(</span><span class="n">tpdu_data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">first_checksum_octet</span><span class="p">))</span>
</span><span data-line="593">            <span class="k">return</span> <span class="n">pack</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
</span><span data-line="594">
</span><span data-line="595">        <span class="k">return</span> <span class="n">tpdu_data</span></div>

</span><span data-line="596">
<div class="viewcode-block" id="TPDU.from_octets">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU.from_octets">[docs]</a>
</span><span data-line="597">    <span class="nd">@classmethod</span>
</span><span data-line="598">    <span class="k">def</span><span class="w"> </span><span class="nf">from_octets</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">octets</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">):</span>
</span><span data-line="599"><span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="600"><span class="sd">        Deserialize raw octets into a TPDU (or subclass) instance.</span>
</span><span data-line="601">
</span><span data-line="602"><span class="sd">        This method unpacks the raw TPDU structure into the corresponding</span>
</span><span data-line="603"><span class="sd">        class representation.</span>
</span><span data-line="604">
</span><span data-line="605"><span class="sd">        :param octets: Encoded TPDU octets.</span>
</span><span data-line="606"><span class="sd">        :type octets: bytes</span>
</span><span data-line="607"><span class="sd">        :return: TPDU instance populated from octets.</span>
</span><span data-line="608"><span class="sd">        :rtype: TPDU</span>
</span><span data-line="609"><span class="sd">        &quot;&quot;&quot;</span>
</span><span data-line="610">        <span class="k">return</span> <span class="n">unpack</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">octets</span><span class="p">)</span></div>
</div>

</span><span data-line="611">
</span><span data-line="612">
<div class="viewcode-block" id="TPDU_ClassOption">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ClassOption">[docs]</a>
</span><span data-line="613"><span class="nd">@bitfield</span><span class="p">(</span><span class="n">options</span><span class="o">=</span><span class="p">[</span><span class="n">S_ADD_BYTES</span><span class="p">])</span>
</span><span data-line="614"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ClassOption</span><span class="p">:</span>
</span><span data-line="615"><span class="w">    </span><span class="sd">&quot;&quot;&quot;CLASS OPTION</span>
</span><span data-line="616">
</span><span data-line="617"><span class="sd">    Defines the preferred transport protocol class to be operated over the</span>
</span><span data-line="618"><span class="sd">    requested transport connection.</span>
</span><span data-line="619"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="620">
</span><span data-line="621">    <span class="c1"># fmt: off</span>
</span><span data-line="622">    <span class="n">class_id</span>              <span class="p">:</span> <span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">EnumFactory</span><span class="p">(</span><span class="n">TPDU_Class</span><span class="p">))</span> <span class="o">=</span> <span class="n">TPDU_Class</span><span class="o">.</span><span class="n">CLASS0</span>
</span><span data-line="623">    <span class="n">reserved</span>              <span class="p">:</span>  <span class="mi">2</span>                           <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="624">    <span class="n">extended_formats</span>      <span class="p">:</span>  <span class="mi">1</span>                           <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="625">    <span class="n">explicit_flow_control</span> <span class="p">:</span>  <span class="mi">1</span>                           <span class="o">=</span> <span class="kc">False</span></div>

</span><span data-line="626">    <span class="c1"># fmt: on</span>
</span><span data-line="627">
</span><span data-line="628">
</span><span data-line="629"><span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="n">Parameter</span><span class="p">[</span><span class="o">...</span><span class="p">]</span>
</span><span data-line="630"><span class="sd">&quot;&quot;&quot;13.2.3 Variable part</span>
</span><span data-line="631">
</span><span data-line="632"><span class="sd">The variable part is used to define less frequently used parameters. If the</span>
</span><span data-line="633"><span class="sd">variable part is present, it shall contain one or more parameters.</span>
</span><span data-line="634"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="635">
</span><span data-line="636"><span class="n">TPDU_UserData</span> <span class="o">=</span> <span class="n">Bytes</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
</span><span data-line="637"><span class="sd">&quot;&quot;&quot;13.2.4 Data field</span>
</span><span data-line="638">
</span><span data-line="639"><span class="sd">This field contains transparent user data</span>
</span><span data-line="640"><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="641">
</span><span data-line="642">
<div class="viewcode-block" id="TPDU_ConnectionRequest">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ConnectionRequest">[docs]</a>
</span><span data-line="643"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="644"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ConnectionRequest</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="645"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.3 Connection Request (CR) TPDU&quot;&quot;&quot;</span>
</span><span data-line="646">
</span><span data-line="647">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="648">
</span><span data-line="649">    <span class="c1"># fmt: off</span>
</span><span data-line="650">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="651"><span class="w">    </span><span class="sd">&quot;&quot;&quot;c) DST-REF - Set to zero.&quot;&quot;&quot;</span>
</span><span data-line="652">
</span><span data-line="653">    <span class="n">src_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="654"><span class="w">    </span><span class="sd">&quot;&quot;&quot;d) SRC-REF</span>
</span><span data-line="655">
</span><span data-line="656"><span class="sd">    Reference selected by the transport entity initiating the CR-TPDU to</span>
</span><span data-line="657"><span class="sd">    identify the requested transport connection.</span>
</span><span data-line="658"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="659">
</span><span data-line="660">    <span class="n">class_opt</span><span class="p">:</span> <span class="n">TPDU_ClassOption</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="661"><span class="w">    </span><span class="sd">&quot;&quot;&quot;e) CLASS OPTION</span>
</span><span data-line="662">
</span><span data-line="663"><span class="sd">    Bits 8 to 5 of octet 7 define the preferred transport protocol class to be</span>
</span><span data-line="664"><span class="sd">    operated over the requested transport connection. The CR-TPDU contains the</span>
</span><span data-line="665"><span class="sd">    first choice of class in the fixed part. Second and subsequent choices are</span>
</span><span data-line="666"><span class="sd">    listed in the variable part if required.</span>
</span><span data-line="667"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="668">
</span><span data-line="669">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="670"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.3.4 Variable part</span>
</span><span data-line="671">
</span><span data-line="672"><span class="sd">    The following parameters are permitted in the variable part:</span>
</span><span data-line="673">
</span><span data-line="674"><span class="sd">    - a) Transport-Selector (T-selector)</span>
</span><span data-line="675"><span class="sd">    - b) TPDU size</span>
</span><span data-line="676"><span class="sd">    - c) Preferred maximum TPDU size</span>
</span><span data-line="677"><span class="sd">    - d) Version number (not used if class 0 is the preferred class)</span>
</span><span data-line="678"><span class="sd">    - e) Protection parameters (not used is class 0 is the preferred class)</span>
</span><span data-line="679"><span class="sd">    - f) Checksum (used only if class 4 is the preferred class)</span>
</span><span data-line="680"><span class="sd">    - h) Alternative protocol class(es) (not used if class 0 is the preferred</span>
</span><span data-line="681"><span class="sd">         class or when operating over CLNS) Parameter code:</span>
</span><span data-line="682"><span class="sd">    - i) Acknowledgement time (used only if class 4 is the preferred class)</span>
</span><span data-line="683"><span class="sd">    - j) Throughput (not used if class 0 is the preferred class)</span>
</span><span data-line="684"><span class="sd">    - k) Residual error rate (not used if class 0 is the preferred class)</span>
</span><span data-line="685"><span class="sd">    - l) Priority (not used if class 0 is the preferred class)</span>
</span><span data-line="686"><span class="sd">    - m) Transit delay (not used if class 0 is the preferred class)</span>
</span><span data-line="687"><span class="sd">    - n) Reassignment time (not used if class 0 or 2 is the preferred class; if</span>
</span><span data-line="688"><span class="sd">         class 4 is preferred and class 3 is an alternate, it may be used)</span>
</span><span data-line="689"><span class="sd">    - o) Inactivity timer (used only if class 4 is the preferred or selected</span>
</span><span data-line="690"><span class="sd">         class)</span>
</span><span data-line="691"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="692">
</span><span data-line="693">    <span class="n">user_data</span><span class="p">:</span> <span class="n">TPDU_UserData</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="694"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="695"><span class="sd">    No user data are permitted in class 0, and are optional in other classes.</span>
</span><span data-line="696"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="697">    <span class="c1"># fmt: on</span>
</span><span data-line="698">
</span><span data-line="699">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
</span><span data-line="700">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">CR</span>
</span><span data-line="701">        <span class="bp">self</span><span class="o">.</span><span class="n">class_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_opt</span> <span class="ow">or</span> <span class="n">TPDU_ClassOption</span><span class="p">()</span>
</span><span data-line="702">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="703">        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span></div>

</span><span data-line="704">
</span><span data-line="705">
<div class="viewcode-block" id="TPDU_ConnectionConfirm">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ConnectionConfirm">[docs]</a>
</span><span data-line="706"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="707"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ConnectionConfirm</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="708"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.4Connection Confirm (CC) TPDU&quot;&quot;&quot;</span>
</span><span data-line="709">
</span><span data-line="710">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="711">
</span><span data-line="712">    <span class="c1"># fmt: off</span>
</span><span data-line="713">    <span class="n">dst_ref</span>    <span class="p">:</span> <span class="n">uint16</span>                                 <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="714"><span class="w">    </span><span class="sd">&quot;&quot;&quot;c) DST-REF</span>
</span><span data-line="715">
</span><span data-line="716"><span class="sd">    Reference identifying the requested transport connection at the remote</span>
</span><span data-line="717"><span class="sd">    transport entity.</span>
</span><span data-line="718"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="719">
</span><span data-line="720">    <span class="n">src_ref</span>    <span class="p">:</span> <span class="n">uint16</span>                                 <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="721"><span class="w">    </span><span class="sd">&quot;&quot;&quot;d) SRC-REF</span>
</span><span data-line="722">
</span><span data-line="723"><span class="sd">    Reference selected by the transport entity initiating the CC-TPDU to</span>
</span><span data-line="724"><span class="sd">    identify the confirmed transport connection.</span>
</span><span data-line="725"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="726">
</span><span data-line="727">    <span class="n">class_opt</span>  <span class="p">:</span> <span class="n">TPDU_ClassOption</span>                       <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="728"><span class="w">    </span><span class="sd">&quot;&quot;&quot;e) CLASS OPTION</span>
</span><span data-line="729">
</span><span data-line="730"><span class="sd">    Defines the selected transport protocol class and option to be operated over</span>
</span><span data-line="731"><span class="sd">    the accepted transport connection.</span>
</span><span data-line="732"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="733">
</span><span data-line="734">    <span class="n">parameters</span> <span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="735"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Same as in :class:`TPDU_ConnectionRequest`&quot;&quot;&quot;</span>
</span><span data-line="736">
</span><span data-line="737">    <span class="n">user_data</span>  <span class="p">:</span> <span class="n">TPDU_UserData</span>                          <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="738"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.4.5 User Data</span>
</span><span data-line="739">
</span><span data-line="740"><span class="sd">    No user data are permitted in class 0, and are optional in the other classes.</span>
</span><span data-line="741"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="742">    <span class="c1"># fmt: on</span>
</span><span data-line="743">
</span><span data-line="744">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="745">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">CC</span>
</span><span data-line="746">        <span class="bp">self</span><span class="o">.</span><span class="n">class_opt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">class_opt</span> <span class="ow">or</span> <span class="n">TPDU_ClassOption</span><span class="p">()</span>
</span><span data-line="747">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="748">        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span></div>

</span><span data-line="749">
</span><span data-line="750">
<div class="viewcode-block" id="TPDU_DisconnectRequest">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_DisconnectRequest">[docs]</a>
</span><span data-line="751"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="752"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_DisconnectRequest</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="753"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.5 Disconnect Request (DR) TPDU</span>
</span><span data-line="754">
</span><span data-line="755"><span class="sd">    The DR-TPDU is used to terminate a transport connection. It may carry</span>
</span><span data-line="756"><span class="sd">    parameters and optional user data.</span>
</span><span data-line="757"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="758">
</span><span data-line="759">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="760">
</span><span data-line="761">    <span class="c1"># fmt: off</span>
</span><span data-line="762">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="763"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection to be</span>
</span><span data-line="764"><span class="sd">    released.&quot;&quot;&quot;</span>
</span><span data-line="765">
</span><span data-line="766">    <span class="n">src_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="767"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source reference — identifies the transport connection from the sender&#39;s</span>
</span><span data-line="768"><span class="sd">    perspective.&quot;&quot;&quot;</span>
</span><span data-line="769">
</span><span data-line="770">    <span class="n">reason</span><span class="p">:</span> <span class="n">TPDU_DisconnectReason</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="771"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reason code for disconnection (X.224 §13.5.4).&quot;&quot;&quot;</span>
</span><span data-line="772">
</span><span data-line="773">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="774"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional parameters (variable part)</span>
</span><span data-line="775">
</span><span data-line="776"><span class="sd">    Allowed parameters:</span>
</span><span data-line="777">
</span><span data-line="778"><span class="sd">    - a) Additional information</span>
</span><span data-line="779"><span class="sd">    - b) Checksum</span>
</span><span data-line="780"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="781">
</span><span data-line="782">    <span class="n">user_data</span><span class="p">:</span> <span class="n">TPDU_UserData</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="783"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional user data — must not exceed 64 octets.&quot;&quot;&quot;</span>
</span><span data-line="784">    <span class="c1"># fmt: on</span>
</span><span data-line="785">
</span><span data-line="786">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="787">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="788">        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="789">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DR</span></div>

</span><span data-line="790">
</span><span data-line="791">
<div class="viewcode-block" id="TPDU_DisconnectConfirm">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_DisconnectConfirm">[docs]</a>
</span><span data-line="792"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="793"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_DisconnectConfirm</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="794"><span class="w">    </span><span class="sd">&quot;&quot;&quot;3.6 Disconnect Confirm (DC) TPDU</span>
</span><span data-line="795">
</span><span data-line="796"><span class="sd">    The DC-TPDU is sent in response to a DR-TPDU to confirm the disconnection</span>
</span><span data-line="797"><span class="sd">    of a transport connection.</span>
</span><span data-line="798"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="799">
</span><span data-line="800">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span data-line="801">
</span><span data-line="802">    <span class="c1"># fmt: off</span>
</span><span data-line="803">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="804"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection being</span>
</span><span data-line="805"><span class="sd">    confirmed as disconnected.&quot;&quot;&quot;</span>
</span><span data-line="806">
</span><span data-line="807">    <span class="n">src_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="808"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Source reference — identifies the transport connection from the sender&#39;s</span>
</span><span data-line="809"><span class="sd">    perspective.&quot;&quot;&quot;</span>
</span><span data-line="810">
</span><span data-line="811">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">5</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="812"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Only checksum is allowed as a parameter&quot;&quot;&quot;</span>
</span><span data-line="813">    <span class="c1"># fmt: on</span>
</span><span data-line="814">
</span><span data-line="815">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="816">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="817">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DC</span></div>

</span><span data-line="818">
</span><span data-line="819">
<div class="viewcode-block" id="TPDU_Number">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Number">[docs]</a>
</span><span data-line="820"><span class="nd">@bitfield</span>
</span><span data-line="821"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Number</span><span class="p">:</span>
</span><span data-line="822">    <span class="n">eot</span><span class="p">:</span> <span class="mi">1</span> <span class="o">=</span> <span class="kc">False</span>
</span><span data-line="823"><span class="w">    </span><span class="sd">&quot;&quot;&quot;d) EOT</span>
</span><span data-line="824">
</span><span data-line="825"><span class="sd">    When set to ONE, it indicates that the current DT-TPDU is the last data unit</span>
</span><span data-line="826"><span class="sd">    of a complete DT-TPDU sequence (end of TSDU).</span>
</span><span data-line="827"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="828">
</span><span data-line="829">    <span class="n">value</span><span class="p">:</span> <span class="mi">7</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="830"><span class="w">    </span><span class="sd">&quot;&quot;&quot;e) TPDU-NR</span>
</span><span data-line="831">
</span><span data-line="832"><span class="sd">    TPDU send sequence number (zero in class 0). May take any value in class 2</span>
</span><span data-line="833"><span class="sd">    without explicit flow control. TPDU-NR is bits 7 to 1 of octet 3 for</span>
</span><span data-line="834"><span class="sd">    classes 0 and 1, bits 7 to 1 of octet 5 for classes 2, 3 and 4.</span>
</span><span data-line="835"><span class="sd">    &quot;&quot;&quot;</span></div>

</span><span data-line="836">
</span><span data-line="837">
<div class="viewcode-block" id="TPDU_Data">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Data">[docs]</a>
</span><span data-line="838"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="839"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Data</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="840"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.7 Data (DT) TPDU</span>
</span><span data-line="841">
</span><span data-line="842"><span class="sd">    The DA-TPDU is used to transfer data over a transport connection. It may</span>
</span><span data-line="843"><span class="sd">    carry parameters and optional user data.</span>
</span><span data-line="844"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="845">
</span><span data-line="846">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">2</span>
</span><span data-line="847">
</span><span data-line="848">    <span class="c1"># fmt: off</span>
</span><span data-line="849">    <span class="n">nr</span><span class="p">:</span> <span class="n">TPDU_Number</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="850"><span class="w">    </span><span class="sd">&quot;&quot;&quot;e) TPDU-NR&quot;&quot;&quot;</span>
</span><span data-line="851">
</span><span data-line="852">    <span class="n">user_data</span><span class="p">:</span> <span class="n">TPDU_UserData</span> <span class="o">=</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="853"><span class="w">    </span><span class="sd">&quot;&quot;&quot;This field contains data of the TSDU being transmitted.&quot;&quot;&quot;</span>
</span><span data-line="854">    <span class="c1"># fmt: on</span>
</span><span data-line="855">
</span><span data-line="856">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="857">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">nr</span><span class="p">,</span> <span class="n">TPDU_Number</span><span class="p">):</span>
</span><span data-line="858">            <span class="bp">self</span><span class="o">.</span><span class="n">nr</span> <span class="o">=</span> <span class="n">TPDU_Number</span><span class="p">()</span>
</span><span data-line="859">        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="860">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DT</span>
</span><span data-line="861">
</span><span data-line="862">    <span class="nd">@property</span>
</span><span data-line="863">    <span class="k">def</span><span class="w"> </span><span class="nf">tpdu_nr</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
</span><span data-line="864">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr</span><span class="o">.</span><span class="n">value</span>
</span><span data-line="865">
</span><span data-line="866">    <span class="nd">@property</span>
</span><span data-line="867">    <span class="k">def</span><span class="w"> </span><span class="nf">is_last</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
</span><span data-line="868">        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">nr</span><span class="o">.</span><span class="n">eot</span></div>

</span><span data-line="869">
</span><span data-line="870">
<div class="viewcode-block" id="TPDU_ExpeditedData">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ExpeditedData">[docs]</a>
</span><span data-line="871"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="872"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ExpeditedData</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="873"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.8 Expedited Data (ED) TPDU</span>
</span><span data-line="874">
</span><span data-line="875"><span class="sd">    The ED-TPDU is used to send expedited (urgent) data across the transport</span>
</span><span data-line="876"><span class="sd">    connection.</span>
</span><span data-line="877"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="878">
</span><span data-line="879">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
</span><span data-line="880">
</span><span data-line="881">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="882"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection to which the</span>
</span><span data-line="883"><span class="sd">    expedited data belongs.&quot;&quot;&quot;</span>
</span><span data-line="884">
</span><span data-line="885">    <span class="n">ed_nr</span><span class="p">:</span> <span class="n">TPDU_Number</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="886"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Sequence number for expedited data (X.224 §13.8.4).&quot;&quot;&quot;</span>
</span><span data-line="887">
</span><span data-line="888">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="889"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Only checksum is allowed as a parameter&quot;&quot;&quot;</span>
</span><span data-line="890">
</span><span data-line="891">    <span class="n">user_data</span><span class="p">:</span> <span class="n">TPDU_UserData</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="892"><span class="w">    </span><span class="sd">&quot;&quot;&quot;The expedited data payload — must not exceed the maximum allowed for</span>
</span><span data-line="893"><span class="sd">    expedited service.&quot;&quot;&quot;</span>
</span><span data-line="894">
</span><span data-line="895">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="896">        <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_data</span> <span class="ow">or</span> <span class="sa">b</span><span class="s2">&quot;&quot;</span>
</span><span data-line="897">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ed_nr</span><span class="p">,</span> <span class="n">TPDU_Number</span><span class="p">):</span>
</span><span data-line="898">            <span class="bp">self</span><span class="o">.</span><span class="n">ed_nr</span> <span class="o">=</span> <span class="n">TPDU_Number</span><span class="p">()</span>
</span><span data-line="899">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="900">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">ED</span></div>

</span><span data-line="901">
</span><span data-line="902">
<div class="viewcode-block" id="TPDU_DataAcknowledgement">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_DataAcknowledgement">[docs]</a>
</span><span data-line="903"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="904"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_DataAcknowledgement</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="905"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.9 Data Acknowledgement (AK) TPDU</span>
</span><span data-line="906">
</span><span data-line="907"><span class="sd">    The AK-TPDU acknowledges receipt of data and communicates flow control</span>
</span><span data-line="908"><span class="sd">    information.</span>
</span><span data-line="909"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="910">
</span><span data-line="911">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">6</span>
</span><span data-line="912">
</span><span data-line="913">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="914"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection.&quot;&quot;&quot;</span>
</span><span data-line="915">
</span><span data-line="916">    <span class="n">next_nr</span><span class="p">:</span> <span class="n">TPDU_Number</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="917"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Next expected TPDU sequence number.&quot;&quot;&quot;</span>
</span><span data-line="918">
</span><span data-line="919">    <span class="n">credit</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="920"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Flow control credit — number of TPDUs the sender is prepared to receive.&quot;&quot;&quot;</span>
</span><span data-line="921">
</span><span data-line="922">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">6</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="923"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional parameters allowed in AK-TPDU:</span>
</span><span data-line="924">
</span><span data-line="925"><span class="sd">    - a) Checksum</span>
</span><span data-line="926"><span class="sd">    - b) Subsequence number when optionally used under the conditions defined in</span>
</span><span data-line="927"><span class="sd">         class 4.</span>
</span><span data-line="928"><span class="sd">    - c) Flow control confirmation when optionally used under the conditions</span>
</span><span data-line="929"><span class="sd">         defined in class 4.</span>
</span><span data-line="930"><span class="sd">    - d) Selective acknowledgement parameters when optionally used, under</span>
</span><span data-line="931"><span class="sd">         conditions defined in class 4.</span>
</span><span data-line="932"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="933">    <span class="c1"># fmt: on</span>
</span><span data-line="934">
</span><span data-line="935">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="936">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="937">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">AK</span>
</span><span data-line="938">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">next_nr</span><span class="p">,</span> <span class="n">TPDU_Number</span><span class="p">):</span>
</span><span data-line="939">            <span class="bp">self</span><span class="o">.</span><span class="n">next_nr</span> <span class="o">=</span> <span class="n">TPDU_Number</span><span class="p">()</span></div>

</span><span data-line="940">
</span><span data-line="941">
<div class="viewcode-block" id="TPDU_ExpeditedDataAcknowledgement">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_ExpeditedDataAcknowledgement">[docs]</a>
</span><span data-line="942"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="943"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_ExpeditedDataAcknowledgement</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="944"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.10 Expedited Data Acknowledgement (EA) TPDU</span>
</span><span data-line="945">
</span><span data-line="946"><span class="sd">    The EA-TPDU is used to acknowledge receipt of expedited data (ED TPDUs).</span>
</span><span data-line="947"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="948">
</span><span data-line="949">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
</span><span data-line="950">
</span><span data-line="951">    <span class="c1"># fmt: off</span>
</span><span data-line="952">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="953"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection.&quot;&quot;&quot;</span>
</span><span data-line="954">
</span><span data-line="955">    <span class="n">ed_nr</span><span class="p">:</span> <span class="n">TPDU_Number</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="956"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Expedited data sequence number being acknowledged.&quot;&quot;&quot;</span>
</span><span data-line="957">
</span><span data-line="958">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="959"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Only checksum is allowed as a parameter&quot;&quot;&quot;</span>
</span><span data-line="960">    <span class="c1"># fmt: on</span>
</span><span data-line="961">
</span><span data-line="962">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="963">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">EA</span>
</span><span data-line="964">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span>
</span><span data-line="965">        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ed_nr</span><span class="p">,</span> <span class="n">TPDU_Number</span><span class="p">):</span>
</span><span data-line="966">            <span class="bp">self</span><span class="o">.</span><span class="n">ed_nr</span> <span class="o">=</span> <span class="n">TPDU_Number</span><span class="p">()</span></div>

</span><span data-line="967">
</span><span data-line="968">
<div class="viewcode-block" id="TPDU_Reject">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Reject">[docs]</a>
</span><span data-line="969"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="970"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Reject</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="971"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.11 Reject (RJ) TPDU</span>
</span><span data-line="972">
</span><span data-line="973"><span class="sd">    The RJ-TPDU requests retransmission of certain TPDUs due to detected errors.</span>
</span><span data-line="974"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="975">
</span><span data-line="976">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">5</span>
</span><span data-line="977">
</span><span data-line="978">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="979"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference — identifies the transport connection.&quot;&quot;&quot;</span>
</span><span data-line="980">
</span><span data-line="981">    <span class="n">y_nr</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="982"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Next expected TPDU sequence number (Y(R)).&quot;&quot;&quot;</span>
</span><span data-line="983">
</span><span data-line="984">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="985">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">RJ</span></div>

</span><span data-line="986">
</span><span data-line="987">
</span><span data-line="988"><span class="c1"># Reject cause codes for ER (X.224 §13.12.3)</span>
<div class="viewcode-block" id="ER_RejectCause">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.ER_RejectCause">[docs]</a>
</span><span data-line="989"><span class="k">class</span><span class="w"> </span><span class="nc">ER_RejectCause</span><span class="p">(</span><span class="n">enum</span><span class="o">.</span><span class="n">IntEnum</span><span class="p">):</span>
</span><span data-line="990">    <span class="n">__struct__</span> <span class="o">=</span> <span class="n">uint8</span>
</span><span data-line="991">    <span class="n">REASON_NOT_SPECIFIED</span> <span class="o">=</span> <span class="mh">0x00</span>
</span><span data-line="992">    <span class="n">INVALID_PARAMETER_CODE</span> <span class="o">=</span> <span class="mh">0x01</span>
</span><span data-line="993">    <span class="n">INVALID_TPDU_TYPE</span> <span class="o">=</span> <span class="mh">0x02</span>
</span><span data-line="994">    <span class="n">INVALID_PARAMETER_VALUE</span> <span class="o">=</span> <span class="mh">0x03</span></div>

</span><span data-line="995">
</span><span data-line="996">
<div class="viewcode-block" id="TPDU_Error">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.TPDU_Error">[docs]</a>
</span><span data-line="997"><span class="nd">@struct</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="n">BigEndian</span><span class="p">)</span>
</span><span data-line="998"><span class="k">class</span><span class="w"> </span><span class="nc">TPDU_Error</span><span class="p">(</span><span class="n">TPDU</span><span class="p">):</span>
</span><span data-line="999"><span class="w">    </span><span class="sd">&quot;&quot;&quot;13.12 TPDU error (ER) TPDU</span>
</span><span data-line="1000">
</span><span data-line="1001"><span class="sd">    No user data.</span>
</span><span data-line="1002"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1003">
</span><span data-line="1004">    <span class="n">TPDU_FIXED_SIZE</span> <span class="o">=</span> <span class="mi">4</span>
</span><span data-line="1005">
</span><span data-line="1006">    <span class="c1"># fmt: off</span>
</span><span data-line="1007">    <span class="n">dst_ref</span><span class="p">:</span> <span class="n">uint16</span> <span class="o">=</span> <span class="mi">0</span>
</span><span data-line="1008"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Destination reference (see §13.4.3).&quot;&quot;&quot;</span>
</span><span data-line="1009">
</span><span data-line="1010">    <span class="n">reject_cause</span><span class="p">:</span> <span class="n">ER_RejectCause</span> <span class="o">=</span> <span class="n">ER_RejectCause</span><span class="o">.</span><span class="n">REASON_NOT_SPECIFIED</span>
</span><span data-line="1011"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Reject cause (§13.12.3).&quot;&quot;&quot;</span>
</span><span data-line="1012">
</span><span data-line="1013">    <span class="n">parameters</span><span class="p">:</span> <span class="n">Bytes</span><span class="p">(</span><span class="n">this</span><span class="o">.</span><span class="n">li</span> <span class="o">-</span> <span class="mi">4</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">TPDU_VariablePart</span> <span class="o">=</span> <span class="kc">None</span>
</span><span data-line="1014"><span class="w">    </span><span class="sd">&quot;&quot;&quot;Optional parameters:</span>
</span><span data-line="1015">
</span><span data-line="1016"><span class="sd">    - a) Invalid TPDU</span>
</span><span data-line="1017"><span class="sd">    - b) Checksum</span>
</span><span data-line="1018"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1019">    <span class="c1"># fmt: on</span>
</span><span data-line="1020">
</span><span data-line="1021">    <span class="k">def</span><span class="w"> </span><span class="nf">__post_init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span data-line="1022">        <span class="bp">self</span><span class="o">.</span><span class="n">tpdu_code</span> <span class="o">=</span> <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">ER</span>
</span><span data-line="1023">        <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span> <span class="ow">or</span> <span class="p">[]</span></div>

</span><span data-line="1024">
</span><span data-line="1025">
</span><span data-line="1026"><span class="n">TPDU_TYPES</span> <span class="o">=</span> <span class="p">{</span>
</span><span data-line="1027">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">AK</span><span class="p">:</span> <span class="n">TPDU_DataAcknowledgement</span><span class="p">,</span>
</span><span data-line="1028">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">CC</span><span class="p">:</span> <span class="n">TPDU_ConnectionConfirm</span><span class="p">,</span>
</span><span data-line="1029">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">CR</span><span class="p">:</span> <span class="n">TPDU_ConnectionRequest</span><span class="p">,</span>
</span><span data-line="1030">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DC</span><span class="p">:</span> <span class="n">TPDU_DisconnectConfirm</span><span class="p">,</span>
</span><span data-line="1031">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DR</span><span class="p">:</span> <span class="n">TPDU_DisconnectRequest</span><span class="p">,</span>
</span><span data-line="1032">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">DT</span><span class="p">:</span> <span class="n">TPDU_Data</span><span class="p">,</span>
</span><span data-line="1033">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">EA</span><span class="p">:</span> <span class="n">TPDU_ExpeditedDataAcknowledgement</span><span class="p">,</span>
</span><span data-line="1034">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">ED</span><span class="p">:</span> <span class="n">TPDU_ExpeditedData</span><span class="p">,</span>
</span><span data-line="1035">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">ER</span><span class="p">:</span> <span class="n">TPDU_Error</span><span class="p">,</span>
</span><span data-line="1036">    <span class="n">TPDU_Code</span><span class="o">.</span><span class="n">RJ</span><span class="p">:</span> <span class="n">TPDU_Reject</span><span class="p">,</span>
</span><span data-line="1037"><span class="p">}</span>
</span><span data-line="1038">
</span><span data-line="1039"><span class="c1"># just for typing purposes here</span>
</span><span data-line="1040"><span class="n">_TPDULike</span> <span class="o">=</span> <span class="p">(</span>
</span><span data-line="1041">    <span class="n">TPDU</span>
</span><span data-line="1042">    <span class="o">|</span> <span class="n">TPDU_ConnectionConfirm</span>
</span><span data-line="1043">    <span class="o">|</span> <span class="n">TPDU_ConnectionRequest</span>
</span><span data-line="1044">    <span class="o">|</span> <span class="n">TPDU_Data</span>
</span><span data-line="1045">    <span class="o">|</span> <span class="n">TPDU_DataAcknowledgement</span>
</span><span data-line="1046">    <span class="o">|</span> <span class="n">TPDU_DisconnectConfirm</span>
</span><span data-line="1047">    <span class="o">|</span> <span class="n">TPDU_DisconnectRequest</span>
</span><span data-line="1048">    <span class="o">|</span> <span class="n">TPDU_Error</span>
</span><span data-line="1049">    <span class="o">|</span> <span class="n">TPDU_ExpeditedData</span>
</span><span data-line="1050">    <span class="o">|</span> <span class="n">TPDU_ExpeditedDataAcknowledgement</span>
</span><span data-line="1051">    <span class="o">|</span> <span class="n">TPDU_Reject</span>
</span><span data-line="1052"><span class="p">)</span>
</span><span data-line="1053">
</span><span data-line="1054">
<div class="viewcode-block" id="parse_tpdu">
<a class="viewcode-back" href="../../../../protocols/cotp/structs.html#icspacket.proto.cotp.structs.parse_tpdu">[docs]</a>
</span><span data-line="1055"><span class="k">def</span><span class="w"> </span><span class="nf">parse_tpdu</span><span class="p">(</span><span class="n">octets</span><span class="p">:</span> <span class="nb">bytes</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_TPDULike</span><span class="p">:</span>
</span><span data-line="1056"><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
</span><span data-line="1057"><span class="sd">    Parse a TPDU (Transport Protocol Data Unit) from raw octets.</span>
</span><span data-line="1058">
</span><span data-line="1059"><span class="sd">    First decodes a generic :class:`TPDU` to extract the TPDU code and uses this</span>
</span><span data-line="1060"><span class="sd">    to dispatch to the corresponding TPDU subclass implementation defined in</span>
</span><span data-line="1061"><span class="sd">    :data:`TPDU_TYPES`.</span>
</span><span data-line="1062">
</span><span data-line="1063"><span class="sd">    Example:</span>
</span><span data-line="1064">
</span><span data-line="1065"><span class="sd">    &gt;&gt;&gt; tpdu = parse_tpdu(...)</span>
</span><span data-line="1066"><span class="sd">    &gt;&gt;&gt; isinstance(tpdu, TPDU_Data)</span>
</span><span data-line="1067"><span class="sd">    True</span>
</span><span data-line="1068"><span class="sd">    &gt;&gt;&gt; data: bytes = tpdu.user_data</span>
</span><span data-line="1069">
</span><span data-line="1070"><span class="sd">    :param octets: Raw TPDU octets to parse.</span>
</span><span data-line="1071"><span class="sd">    :type octets: bytes</span>
</span><span data-line="1072"><span class="sd">    :raises ValueError: If the octet buffer is shorter than two bytes.</span>
</span><span data-line="1073"><span class="sd">    :return: A parsed TPDU instance corresponding to the TPDU code</span>
</span><span data-line="1074"><span class="sd">             (e.g., :class:`TPDU_ConnectionRequest`).</span>
</span><span data-line="1075"><span class="sd">    :rtype: _TPDULike</span>
</span><span data-line="1076"><span class="sd">    &quot;&quot;&quot;</span>
</span><span data-line="1077">    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span data-line="1078">        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;TPDU must have at least 2 octets&quot;</span><span class="p">)</span>
</span><span data-line="1079">
</span><span data-line="1080">    <span class="n">tpdu_base</span> <span class="o">=</span> <span class="n">TPDU</span><span class="o">.</span><span class="n">from_octets</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span>
</span><span data-line="1081">    <span class="n">tpdu_type</span> <span class="o">=</span> <span class="n">TPDU_TYPES</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">tpdu_base</span><span class="o">.</span><span class="n">tpdu_code</span><span class="p">,</span> <span class="n">TPDU</span><span class="p">)</span>
</span><span data-line="1082">    <span class="k">return</span> <span class="n">tpdu_type</span><span class="o">.</span><span class="n">from_octets</span><span class="p">(</span><span class="n">octets</span><span class="p">)</span></div>

</span></pre></div>
        </article><button class="back-to-top" type="button">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
    <path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"></path>
  </svg>
  <span>Back to top</span>
</button><div class="navigation flex print:hidden"></div></div>
    </div>
  </main>
</div>
<footer class="sy-foot">
  <div class="sy-foot-inner sy-container mx-auto">
    <div class="sy-foot-reserved md:flex justify-between items-center">
      <div class="sy-foot-copyright"><p>2025, MatrixEditor</p>
  
  <p>
    Made with
    
    <a href="https://www.sphinx-doc.org/">Sphinx</a> and
    
    <a href="https://shibuya.lepture.com">Shibuya theme</a>.
  </p>
</div>
      <div class="sy-foot-socials">
<a href="https://github.com/MatrixEditor/icspacket" aria-label="GitHub">
  <iconify-icon icon="simple-icons:github"></iconify-icon>
</a></div>
    </div>
  </div>
</footer>
      <script src="../../../../_static/documentation_options.js?v=d27f7911"></script>
      <script src="../../../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../../../_static/sphinx_highlight.js?v=dc90522c"></script>
      <script src="../../../../_static/clipboard.min.js?v=a7894cd8"></script>
      <script src="../../../../_static/copybutton.js?v=f281be69"></script>
      <script src="../../../../_static/design-tabs.js?v=f930bc37"></script>
      <script src="../../../../_static/shibuya.js?v=e730760c"></script></body>
</html>